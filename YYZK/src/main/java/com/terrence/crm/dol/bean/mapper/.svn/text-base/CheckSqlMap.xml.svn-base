<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Check">

        
	<resultMap id="RM.Check" class="com.terrence.crm.dol.bean.Check">
        <result property="checkid" column="checkid"/>
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="checktype" column="checktype"/>
        <result property="createtime" column="createtime"/>
        <result property="checktime" column="checktime"/>
        <result property="checknum" column="checknum"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="operationdiscardnum" column="operationdiscardnum"/>
        <result property="itemdiscardnum" column="itemdiscardnum"/>
        <result property="repairnum" column="repairnum"/>
        <result property="repariacceptnum" column="repariacceptnum"/>
        <result property="checkemp" column="checkemp"/>
        <result property="explain" column="explain"/>
        <result property="checkstatus" column="checkstatus"/>
        <result property="reqemp" column="reqemp"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="processid" column="processid"/>
        <result property="workid" column="workid"/>
        <result property="batchno" column="batchno"/>
        <result property="feesinnum" column="feesinnum"/>
        <result property="rework" column="rework"/>
        <result property="receviernum" column="receviernum"/>
        <result property="teamid" column="teamid"/>
        <result property="classshift" column="classshift"/>
        <result property="price" column="price"/>
        <result property="wage" column="wage"/>
        <result property="processname" column="processname"/>
        <result property="ratio" column="ratio"/>
        <result property="totalratio" column="totalratio"/>
        <result property="classratio" column="classratio"/>
        <result property="itemprocessid" column="itemprocessid"/>
    </resultMap>
	<resultMap id="RM.Check.Process" class="com.terrence.crm.dol.bean.Check">
        <result property="checkid" column="checkid"/>
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="checktype" column="checktype"/>
        <result property="createtime" column="createtime"/>
        <result property="checktime" column="checktime"/>
        <result property="checknum" column="checknum"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="operationdiscardnum" column="operationdiscardnum"/>
        <result property="itemdiscardnum" column="itemdiscardnum"/>
        <result property="repairnum" column="repairnum"/>
        <result property="repariacceptnum" column="repariacceptnum"/>
        <result property="checkemp" column="checkemp"/>
        <result property="explain" column="explain"/>
        <result property="checkstatus" column="checkstatus"/>
        <result property="reqemp" column="reqemp"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="processid" column="processid"/>
        <result property="workid" column="workid"/>
        <result property="batchno" column="batchno"/>
        <result property="feesinnum" column="feesinnum"/>
        <result property="rework" column="rework"/>
        <result property="receviernum" column="receviernum"/>
        <result property="teamid" column="teamid"/>
        <result property="itemprocessid" column="itemprocessid"/>
        <result property="classshift" column="classshift"/>
        <result property="price" column="price"/>
        <result property="wage" column="wage"/>
        <result property="processname" column="processname"/>
        <result property="ratio" column="ratio"/>
        <result property="totalratio" column="totalratio"/>
        <result property="classratio" column="classratio"/>
        <result property="procedure" resultMap="RM.Check.Procdeure.Detail"/>
        <result property="admin" resultMap="RM.Check.Admin.Detail"/>
    </resultMap>
    
    
    <resultMap id="RM.Check.Process.Includebatch" class="com.terrence.crm.dol.bean.Check">
        <result property="checkid" column="checkid"/>
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="checktype" column="checktype"/>
        <result property="createtime" column="createtime"/>
        <result property="checktime" column="checktime"/>
        <result property="checknum" column="checknum"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="operationdiscardnum" column="operationdiscardnum"/>
        <result property="itemdiscardnum" column="itemdiscardnum"/>
        <result property="repairnum" column="repairnum"/>
        <result property="repariacceptnum" column="repariacceptnum"/>
        <result property="checkemp" column="checkemp"/>
        <result property="explain" column="explain"/>
        <result property="checkstatus" column="checkstatus"/>
        <result property="reqemp" column="reqemp"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="processid" column="processid"/>
        <result property="workid" column="workid"/>
        <result property="batchno" column="batchno"/>
        <result property="feesinnum" column="feesinnum"/>
        <result property="rework" column="rework"/>
        <result property="receviernum" column="receviernum"/>
        <result property="teamid" column="teamid"/>
        <result property="itemprocessid" column="itemprocessid"/>
        <result property="classshift" column="classshift"/>
        <result property="price" column="price"/>
        <result property="wage" column="wage"/>
        <result property="processname" column="processname"/>
        <result property="ratio" column="ratio"/>
        <result property="totalratio" column="totalratio"/>
        <result property="classratio" column="classratio"/>
        <result property="procedure" resultMap="RM.Check.Procdeure.Detail"/>
        <result property="admin" resultMap="RM.Check.Admin.Detail"/>
        <result property="batch" column="batch"/>
        
    </resultMap>
    
    
    
    	<resultMap id="RM.Check.ItemProcess" class="com.terrence.crm.dol.bean.Check">
        <result property="checkid" column="checkid"/>
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="checktype" column="checktype"/>
        <result property="createtime" column="createtime"/>
        <result property="checktime" column="checktime"/>
        <result property="checknum" column="checknum"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="operationdiscardnum" column="operationdiscardnum"/>
        <result property="itemdiscardnum" column="itemdiscardnum"/>
        <result property="repairnum" column="repairnum"/>
        <result property="repariacceptnum" column="repariacceptnum"/>
        <result property="checkemp" column="checkemp"/>
        <result property="explain" column="explain"/>
        <result property="checkstatus" column="checkstatus"/>
        <result property="reqemp" column="reqemp"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="processid" column="processid"/>
        <result property="workid" column="workid"/>
        <result property="batchno" column="batchno"/>
        <result property="feesinnum" column="feesinnum"/>
        <result property="rework" column="rework"/>
        <result property="receviernum" column="receviernum"/>
        <result property="teamid" column="teamid"/>
        <result property="itemprocessid" column="itemprocessid"/>
        <result property="classshift" column="classshift"/>
        <result property="price" column="price"/>
        <result property="wage" column="wage"/>
        <result property="processname" column="processname"/>
        <result property="ratio" column="ratio"/>
        <result property="totalratio" column="totalratio"/>
        <result property="classratio" column="classratio"/>
        <result property="procedure" resultMap="RM.Check.Procdeure.Detail"/>
        <result property="admin" resultMap="RM.Check.Admin.Detail"/>
        <result property="itemprocess" resultMap="RM.Check.Itemprocess.Detail"/>
        
    </resultMap>
    <resultMap id="RM.Check.Procdeure.Detail" class="com.terrence.crm.dol.bean.Procedure">
	 	<result property="procedurename" column="procedurename"/>
	 </resultMap> 
	 <resultMap id="RM.Check.Process.Detail" class="com.terrence.crm.dol.bean.Process">
	 	<result property="processname" column="processname"/>
	 </resultMap> 
	<resultMap id="RM.Check.Admin.Detail" class="com.terrence.crm.dol.bean.Admin">
	 	<result property="adminName" column="adminName"/>
	 </resultMap>
	  
	<resultMap id="RM.Check.Itemprocess.Detail" class="com.terrence.crm.dol.bean.ItemProcess">
	 	<result property="explain" column="itemexplain"/>
	 </resultMap>
	 <resultMap class="com.terrence.crm.dol.bean.Check" id="RM.Current.Month.Report">
		<result property="amount" column="amount"/>
		<result property="adminName" column="adminName"/>
		<result property="yearMonth" column="checktime"/>
		<result property="premoney" column="money"/>
		<result property="reqemp" column="reqemp"/>
		<result property="jobprice" column="jobprice"/>
	</resultMap>
	<resultMap class="com.terrence.crm.dol.bean.Check" id="RM.Current.Month.Report.Detail">
		<result property="createtime" column="createtime"/>
		<result property="checktime" column="checktime"/>
		<result property="teamname" column="teamname"/>
		<result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="processname" column="procedurename"/>
        <result property="wage" column="wage"/>
        <result property="explain" column="explain"/>
		<result property="checknum" column="checknum"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="employeetaskid" column="employeetaskid"/>
        
        
	</resultMap>
		<resultMap id="RM.Check.EmployeeLogs" class="com.terrence.crm.dol.bean.Check">
        
        <result property="checknum" column="checknum"/>
        <result property="checktype" column="checktype"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="wage" column="wage"/>
        <result property="processname" column="processname"/>
        <result property="processid" column="processid"/>
        <result property="preparemoney" column="preparemoney"/>
        
        <result property="admin" resultMap="RM.Check.Admin.idandname"/>
        
    </resultMap>
	<resultMap id="RM.Check.Admin.idandname" class="com.terrence.crm.dol.bean.Admin">
		<result property="adminId" column="adminid"/>
	 	<result property="adminName" column="adminname"/>
	 </resultMap>
	  
	
	<resultMap id="RM.Check.getByEntity.getchecktimes" class="com.terrence.crm.dol.bean.Check">
		<result property="checktimes" column="checktimes"/>
	</resultMap>
	
	 
	<resultMap id="RM.Check.getemp.submit.fqty" class="com.terrence.crm.dol.bean.Check">
		<result property="checknum" column="checknum"/>
	</resultMap>
	  
	
	<resultMap id="RM.Check.getemtaskidanditemcode" class="com.terrence.crm.dol.bean.Check">
		<result property="employeetaskid" column="employeetaskid"/>
		<result property="itemcode" column="itemcode"/>
	</resultMap>
	
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="Check.columns">
	    <![CDATA[
        	t_check.checkid ,
        	t_check.employeetaskid ,
        	t_check.checktype ,
        	t_check.createtime ,
        	t_check.checktime ,
        	t_check.checknum ,
        	t_check.acceptnum ,
        	t_check.operationdiscardnum ,
        	t_check.itemdiscardnum ,
        	t_check.repairnum ,
        	t_check.repariacceptnum ,
        	t_check.checkemp ,
        	t_check.explain ,
        	t_check.checkstatus ,
        	t_check.reqemp ,
        	t_check.itemcode ,
        	t_check.itemname ,
        	t_check.processid ,
        	t_check.workid ,
        	t_check.batchno ,
        	t_check.feesinnum ,
        	t_check.rework ,
        	t_check.receviernum ,
        	t_check.teamid,
        	t_check.itemprocessid ,
        	t_check.classshift ,
        	t_check.price ,
        	t_check.wage ,
        	t_check.processname ,
        	t_check.ratio ,
        	t_check.totalratio ,
        	t_check.classratio 
	    ]]>
	</sql>
	
   <insert id="Check.insert" >
    <![CDATA[
        INSERT INTO
        t_check (
        	employeetaskid ,
        	checktype ,
        	createtime ,
        	checknum ,
        	acceptnum ,
        	operationdiscardnum ,
        	itemdiscardnum ,
        	repairnum ,
        	repariacceptnum ,
        	checkemp ,
        	explain ,
        	checkstatus ,
        	reqemp ,
        	itemcode ,
        	itemname ,
        	processid ,
        	workid ,
        	batchno ,
        	feesinnum ,
        	rework ,
        	receviernum,
        	teamid,
        	itemprocessid ,
        	classshift ,
        	price ,
        	wage ,
        	processname ,
        	ratio ,
        	totalratio ,
        	classratio 
        ) VALUES (
        	#employeetaskid# ,
        	#checktype# ,
        	#createtime# ,
        	#checknum# ,
        	#acceptnum# ,
        	#operationdiscardnum# ,
        	#itemdiscardnum# ,
        	#repairnum# ,
        	#repariacceptnum# ,
        	#checkemp# ,
        	#explain# ,
        	#checkstatus# ,
        	#reqemp# ,
        	#itemcode# ,
        	#itemname# ,
        	#processid# ,
        	#workid# ,
        	#batchno# ,
        	#feesinnum# ,
        	#rework# ,
        	#receviernum# ,
        	#teamid#,
        	#itemprocessid#,
        	#classshift# ,
        	#price# ,
        	#wage# ,
        	#processname# ,
        	#ratio# ,
        	#totalratio# ,
        	#classratio# 
        )
    ]]> 
    <!--
    mysql:		type="post" SELECT  select last_insert_id()
    sqlserver:	type="post" SELECT  @@identity  AS  ID
    oracle:		type="pre" 	SELECT  sequenceName.nextval AS ID FROM DUAL
    DB2:		type="pre"	values nextval for sequenceName
    -->
        <selectKey resultClass="java.lang.Long" type="post" keyProperty="checkid" >
            SELECT  @@identity  AS  ID
        </selectKey>
    </insert>

	<update id="Check.update" parameterClass="com.terrence.crm.dol.bean.Check">         
        UPDATE t_check 
        <dynamic prepend="SET">
	        <isNotEmpty prepend="," property="employeetaskid">
	        	employeetaskid = #employeetaskid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="checktype">
	        	checktype = #checktype# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="createtime">
	        	createtime = #createtime# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="checktime">
	        	checktime = #checktime# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="checknum">
	        	checknum = #checknum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="acceptnum">
	        	acceptnum = #acceptnum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="operationdiscardnum">
	        	operationdiscardnum = #operationdiscardnum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemdiscardnum">
	        	itemdiscardnum = #itemdiscardnum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="repairnum">
	        	repairnum = #repairnum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="repariacceptnum">
	        	repariacceptnum = #repariacceptnum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="checkemp">
	        	checkemp = #checkemp# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="explain">
	        	explain = #explain# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="checkstatus">
	        	checkstatus = #checkstatus# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="reqemp">
	        	reqemp = #reqemp# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	itemcode = #itemcode# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	itemname = #itemname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="processid">
	        	processid = #processid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="workid">
	        	workid = #workid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="batchno">
	        	batchno = #batchno# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="feesinnum">
	        	feesinnum = #feesinnum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="rework">
	        	rework = #rework# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="receviernum">
	        	receviernum = #receviernum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="teamid">
	        	teamid = #teamid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemprocessid">
	        	itemprocessid = #itemprocessid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="classshift">
	        	classshift = #classshift# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="price">
	        	price = #price# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="wage">
	        	wage = #wage# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="processname">
	        	processname = #processname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="ratio">
	        	ratio = #ratio# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="totalratio">
	        	totalratio = #totalratio# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="classratio">
	        	classratio = #classratio# 
	        </isNotEmpty>
	    </dynamic>
        WHERE 
	        checkid = #checkid# 
    </update>
    <delete id="Check.delete.LastMonth">
    delete from t_check where datename(yyyy,checktime)+DATENAME(mm,checktime)=DATENAME(yyyy,getdate())+datename(mm,dateadd(mm,-1,getdate())) 
    </delete>
	<delete id="Check.delete" parameterClass="java.lang.Long">
    <![CDATA[
        delete from t_check where
       checkid = #checkid# 
    ]]>
    </delete>
    
    <delete id="Check.deleteMultiple">
    <![CDATA[
        DELETE FROM 
        	t_check 
        WHERE
       checkid in ($checkid$) 
    ]]>
    </delete>
    
    <delete id="Check.deleteByemployeeid">
    <![CDATA[
        DELETE FROM 
        	t_check 
        WHERE
       employeetaskid =#employeetaskid# 
      ]]>
    </delete>
    
    
    
    <select id="Check.getById" resultMap="RM.Check.Process">
	    select <include refid="Check.columns"/>,t_procedure.procedurename,t_admin.adminName
	        from t_check ,t_procedure,t_admin  where t_check.processid=t_procedure.procedurerid
	        and t_check.reqemp=t_admin.adminid and checkid = #checkid# 
	    
    </select>
    
    <select id="Check.getByIdIncludebatch" resultMap="RM.Check.Process.Includebatch">
	    select <include refid="Check.columns"/>,t_procedure.procedurename,t_admin.adminName,c.batchno batch
	        from t_check left join 
	        (select  t_icmo.icmoid icmoid ,t_circulation.batchno batchno from t_icmo left join t_circulation on t_icmo.fbillno=t_circulation.workno) c
	        on c.icmoid=t_check.workid
	         ,t_procedure,t_admin 
	         where t_check.processid=t_procedure.procedurerid
	        and t_check.reqemp=t_admin.adminid and checkid = #checkid# 
    </select>
    
    
    
	<select id="Check.getByProperty" resultMap="RM.Check">
		select <include refid="Check.columns"/> from t_check where $propertyName$=#propertyValue#
	</select>
	<!-- 修改工艺，级联更新质检任务计件工资 -->
	<update id="Check.update.foritemprocess" parameterClass="com.terrence.crm.dol.bean.Check">
	update t_check set wage=t_item_process.wage from t_item_process where t_item_process.itemprocessid=t_check.itemprocessid
	and datename(yyyy,createtime)+datename(mm,createtime)=#yearMonth# and t_check.itemprocessid=#itemprocessid#
	</update>
	<update id="Check.updateByProcessid" >
		
	update t_check set t_check.wage=#propertyPrice#*t_employee_task.processmins , t_check.price=#propertyPrice#
	
	from t_employee_task
	where t_check.employeetaskid=t_employee_task.employeetaskid 
	and t_check.processid=#propertyId#
	and datename(yyyy,t_check.createtime)+datename(mm,t_check.createtime)=datename(yyyy,getdate())+datename(mm,getdate())

	</update>
	
	
	<sql id="Check.findPage.where">
	    <dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="checkid">
	             t_check.checkid = #checkid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="employeetaskid">
	             t_check.employeetaskid = #employeetaskid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="checktype">
	             t_check.checktype = #checktype#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="createtimeBegin">
	             t_check.createtime &gt;= #createtimeBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="createtimeEnd">
	             t_check.createtime &lt;= #createtimeEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="checktimeBegin">
	             t_check.checktime &gt;= #checktimeBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="checktimeEnd">
	             t_check.checktime &lt;= #checktimeEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="checknum">
	             t_check.checknum = #checknum#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="acceptnum">
	             t_check.acceptnum = #acceptnum#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="operationdiscardnum">
	             t_check.operationdiscardnum = #operationdiscardnum#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemdiscardnum">
	             t_check.itemdiscardnum = #itemdiscardnum#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="repairnum">
	             t_check.repairnum = #repairnum#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="repariacceptnum">
	             t_check.repariacceptnum = #repariacceptnum#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="checkemp">
	             t_check.checkemp = #checkemp#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="explain">
	             t_check.explain = #explain#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="checkstatus">
	             t_check.checkstatus = #checkstatus#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="reqemp">
	             t_check.reqemp = #reqemp#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemcode">
	             t_check.itemcode = #itemcode#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemname">
	             t_check.itemname = #itemname#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="processid">
	             t_check.processid = #processid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="workid">
	             t_check.workid = #workid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="batchno">
	             t_check.batchno = #batchno#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="feesinnum">
	             t_check.feesinnum = #feesinnum#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="rework">
	             t_check.rework = #rework#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="receviernum">
	             t_check.receviernum = #receviernum#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="teamid">
	             t_check.teamid = #teamid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="itemprocessid">
	             t_check.itemprocessid = #itemprocessid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="classshift">
	             t_check.classshift = #classshift#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="price">
	             t_check.price = #price#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="wage">
	             t_check.wage = #wage#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="processname">
	             t_check.processname = #processname#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="ratio">
	             t_check.ratio = #ratio#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="totalratio">
	             t_check.totalratio = #totalratio#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="classratio">
	             t_check.classratio = #classratio#
	       </isNotEmpty>
	    </dynamic>	
	</sql>
	 
    <sql id="Check.findPage.and">
			<isNotEmpty prepend="AND" property="checkid">
	             t_check.checkid = #checkid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="employeetaskid">
	             t_check.employeetaskid = #employeetaskid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="checktype">
	             t_check.checktype = #checktype#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="createtimeBegin">
	             t_check.createtime &gt;= #createtimeBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="createtimeEnd">
	             t_check.createtime &lt;= #createtimeEnd#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="checktimeBegin">
	             t_check.checktime &gt;= #checktimeBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="checktimeEnd">
	             t_check.checktime &lt;= #checktimeEnd#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="checknum">
	             t_check.checknum = #checknum#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="acceptnum">
	             t_check.acceptnum = #acceptnum#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="operationdiscardnum">
	             t_check.operationdiscardnum = #operationdiscardnum#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="itemdiscardnum">
	             t_check.itemdiscardnum = #itemdiscardnum#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="repairnum">
	             t_check.repairnum = #repairnum#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="repariacceptnum">
	             t_check.repariacceptnum = #repariacceptnum#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="checkemp">
	             t_check.checkemp = #checkemp#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="explain">
	             t_check.explain = #explain#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="checkstatus">
	             t_check.checkstatus = #checkstatus#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="reqemp">
	             t_check.reqemp = #reqemp#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="itemcode">
	             t_check.itemcode = #itemcode#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="itemname">
	             t_check.itemname = #itemname#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="processid">
	             t_check.processid = #processid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="workid">
	             t_check.workid = #workid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="batchno">
	             t_check.batchno = #batchno#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="feesinnum">
	             t_check.feesinnum = #feesinnum#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="rework">
	             t_check.rework = #rework#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="receviernum">
	             t_check.receviernum = #receviernum#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="teamid">
	             t_check.teamid = #teamid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="itemprocessid">
	             t_check.itemprocessid = #itemprocessid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="classshift">
	             t_check.classshift = #classshift#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="price">
	             t_check.price = #price#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="wage">
	             t_check.wage = #wage#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="processname">
	             t_check.processname = #processname#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="ratio">
	             t_check.ratio = #ratio#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="totalratio">
	             t_check.totalratio = #totalratio#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="classratio">
	             t_check.classratio = #classratio#
	       </isNotEmpty>
	</sql>
    <select id="Current.Month.Report" resultMap="RM.Current.Month.Report">
    	select isnull(t_check.amount,0) amount,isnull(isnull(t_check.reqemp,t_job_check.empid),t_pre.empid) reqemp
    	,isnull(t_check.checktime,#beginMonth#) checktime,isnull(t_pre.money,0) money,isnull(t_job_check.jobprice,0) jobprice,
    	t_admin.adminname from(select sum(acceptnum*t_item_process.wage*t_item_process.ratio) amount,t_check.reqemp
		,datename(yyyy,checktime)+datename(mm,checktime) as checktime from t_check,t_item_process 
		where t_check.itemprocessid=t_item_process.itemprocessid  and checktype=3 
		and datename(yyyy,checktime)+datename(mm,checktime) between #beginMonth# and #endMonth# 
		 group by datename(yyyy,checktime)+datename(mm,checktime),t_check.reqemp ) t_check
		full join (select sum(t_item_process.reservefund) money,empid,datename(yyyy,checkdate)+datename(mm,checkdate) checktime
		 from t_prepare_emp,t_item_process	where t_prepare_emp.itemprocessid=t_item_process.itemprocessid 
		and datename(yyyy,checkdate)+datename(mm,checkdate) between #beginMonth# and #endMonth#  
		group by empid ,datename(yyyy,checkdate)+datename(mm,checkdate)) t_pre on t_check.reqemp=t_pre.empid 
		and t_check.checktime=t_pre.checktime
		full join (select  t_job_check.reqemp empid,sum(t_job_check.acceptnum*t_job_check.price) jobprice,
		datename(yyyy,checktime)+datename(mm,checktime)  jobdate  
        from  t_job_check , t_admin 
        where t_job_check.reqemp=t_admin.adminid and datename(yyyy,checktime)+datename(mm,checktime)  between #beginMonth# and #endMonth#  
        group by  t_job_check.reqemp,  datename(yyyy,checktime)+datename(mm,checktime)) t_job_check
		on t_check.reqemp=t_job_check.empid and t_check.checktime=t_job_check.jobdate 
		,t_admin where (t_job_check.empid=t_admin.adminid    or t_check.reqemp=t_admin.adminid or t_pre.empid=t_admin.adminid) 
		<isNotEmpty prepend="AND" property="reqemp">
	             t_admin.adminid = #reqemp#
	    </isNotEmpty>
	    
    </select>
    <select id="Current.Month.Report.Detail" resultMap="RM.Current.Month.Report.Detail">
    select t_check.employeetaskid,t_check.createtime,t_check.checktime,t_teams.teamname,t_check.itemcode,t_check.itemname,t_procedure.procedurename
    ,t_item_process.wage,t_item_process.explain,t_check.checknum,t_check.acceptnum from t_check,t_teams,t_item_process,t_item_procedure,t_procedure
	where datename(yyyy,checktime)+datename(mm,checktime)=#yearMonth# 
      and t_check.reqemp=#reqemp# and checktype=3  and t_check.teamid=t_teams.teamid 
      and t_check.itemprocessid=t_item_process.itemprocessid 
	and t_item_procedure.itemprocedureid=t_item_process.itemprocedureid and t_item_procedure.procedureid=t_procedure.procedurerid
    </select>
    <select id="Check.findList" resultMap="RM.Check">
    	SELECT 
    		<include refid="Check.columns"/> 
    	FROM 
    		t_check
		<include refid="Check.findPage.where"/>
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    
    
    <select id="Check.findPage.count" resultClass="long">
    <![CDATA[
        select count(*) from t_check, t_procedure, t_admin, t_item_process  
    	where  t_check.processid=t_procedure.procedurerid and t_check.reqemp=t_admin.adminid 
        and t_check.itemprocessid=t_item_process.itemprocessid 
    ]]>
		<include refid="Check.findPage.and"/>    
    </select>
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
    -->
    
	<select id="Check.findPage" resultMap="RM.Check.ItemProcess">
    	select <include refid="Check.columns"/>,
	    	t_procedure.procedurename,
	    	t_admin.adminName,
	    	t_item_process.explain itemexplain
    	from 
	    	t_check,t_procedure,t_admin,t_item_process
    	where 
    	 t_check.processid=t_procedure.procedurerid  and t_check.reqemp=t_admin.adminid 		and 
    	 t_check.itemprocessid=t_item_process.itemprocessid
    	 
	   <isNotEmpty property="notTop">  and checkid  not in(select $notTop$  checkid  from t_check <include refid="Check.findPage.where"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="Check.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>

	<select id="Check.findEmployeeLogs" resultMap="RM.Check.EmployeeLogs">
	select t_admin.adminid,t_check.processid,t_admin.adminname,t_check.itemcode,t_check.itemname ,t_check.procedurename processname,t_check.checktype
	,t_check.procedureprice wage,sum(t_check.checknum) checknum ,sum(t_check.preparemoney) preparemoney

	from t_admin left join (select t_check.processid,t_check.itemcode,t_check.itemname,t_check.checktype,t_check.price,t_check.reqemp
				,t_check.checknum,t_procedure.procedurename,t_check.wage procedureprice,t_prepare_emp.money preparemoney
			 from t_check left join t_procedure on t_check.processid=t_procedure.procedurerid 
				 left join t_prepare_emp on t_check.reqemp=t_prepare_emp.empid 
				and t_check.itemcode=t_prepare_emp.itemcode and t_check.employeetaskid=t_prepare_emp.employeetaskid
				 and t_check.checktype=1
				where  
				datename(yyyy,t_check.createtime)+datename(mm,t_check.createtime)+case len(datename(dd,t_check.createtime))
 when 1 then '0'+datename(dd,t_check.createtime) else datename(dd,t_check.createtime) end=#yearMonth#
				
				) t_check
	 on t_admin.adminid=t_check.reqemp and t_check.checktype in(1,3)
	,t_teams
	where  
	t_admin.teamid=t_teams.teamid and t_teams.teamsuperior =(select teamid from t_teams where teamname='机加工车间')
	group by t_admin.adminid,t_check.processid,t_admin.adminname,t_check.itemcode,t_check.itemname,t_check.checktype,t_check.procedureprice,t_check.procedurename
	</select>


	<select id="Check.findTheLastId" resultClass="long">
	    <![CDATA[
	        select a.id from t_dispatch_work a where a.preorder=(
				select b.workseqid from t_dispatch_work b where b.id=(
					select dispatchid from t_employee_task where employeetaskid=(
						select employeetaskid from t_check where checkid=#checkId#
					)
			  	)
			) 
	    ]]>
    </select>



	<select id="Check.findAllAccept" resultClass="java.lang.Integer">
	    <![CDATA[
	        select sum(acceptnum) from t_check where checktype=3 and employeetaskid in(
				select employeetaskid from t_employee_task where dispatchid=(
					select dispatchid from t_employee_task where employeetaskid=(
						select employeetaskid from t_check where checkid=#checkId#
					)
				)
			)
	    ]]>
    </select>


	<select id="Check.findAllDownK3" resultClass="java.lang.Integer">
	    <![CDATA[
	    select sum(fqty) from t_putstorageentity where poorderno=
		(
			select fbillno from t_icmo where icmoid=(
				select workid from t_check where checkid=#checkId#	
			)
		)


	    ]]>
    </select>


	<select id="Check.findLastcheck" resultMap="RM.Check">
			
		select top 1 <include refid="Check.columns"/> from t_check where checktype=3 and employeetaskid in(
			select t_employee_task.employeetaskid from t_employee_task where dispatchid=(
			select t_dispatch_work.id from t_dispatch_work where workseqid not in (select preorder from t_dispatch_work  where workid=#workid#) and workid=#workid#
			)
		)
    </select>




<select id="Check.getByEntity.getchecktimes" resultMap="RM.Check.getByEntity.getchecktimes">
	select  COUNT(*)  checktimes
	from t_check_record 
	where checktype=3 
	and  employeetaskid=#employeetaskid#
</select>




<select id="Check.getemp.submit.fqty" resultMap="RM.Check.getemp.submit.fqty">
	select sum(worknum) checknum from (
		select employeetaskid,worknum from t_check_record  where checktype=3
		UNION ALL
		select employeetaskid,checknum as worknum from t_check where checktype=3
		and checkid not in(
		select checkid from t_check_record where checktype=3
		)
	) allcheck  where employeetaskid=#employeetaskid#
</select>




<select id="Check.getemtaskidanditemcode" resultMap="RM.Check.getemtaskidanditemcode">
select t_check_record.itemcode ,t_check_record.employeetaskid
	from t_check_record
	where  t_check_record.checkid = #checkid# 
</select>



	
</sqlMap>
