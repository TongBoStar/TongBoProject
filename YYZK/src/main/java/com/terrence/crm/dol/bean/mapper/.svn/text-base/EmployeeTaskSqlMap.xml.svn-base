<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="EmployeeTask">

        
	<resultMap id="RM.EmployeeTask" class="com.terrence.crm.dol.bean.EmployeeTask">
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="workid" column="workid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="teamid" column="teamid"/>
        <result property="createtime" column="createtime"/>
        <result property="processid" column="processid"/>
        <result property="fqty" column="fqty"/>
        <result property="processname" column="processname"/>
        <result property="status" column="status"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="prepare" column="prepare"/>
        <result property="planstartdate" column="planstartdate"/>
        <result property="planenddate" column="planenddate"/>
        <result property="finishdate" column="finishdate"/>
        <result property="empid" column="empid"/>
        <result property="deviceid" column="deviceid"/>
        <result property="processmins" column="processmins"/>
        <result property="classtype" column="classtype"/>
        <result property="dispatchid" column="dispatchid"/>
        <result property="firstcheckstatus" column="firstcheckstatus"/>
        <result property="spotcheckstatus" column="spotcheckstatus"/>
        <result property="lastcheckstatus" column="lastcheckstatus"/>
        <result property="itemprocessid" column="itemprocessid"/>
        <result property="centerid" column="centerid"/>
    </resultMap>
    
    <resultMap id="RM.EmployeeTask.Edid" class="com.terrence.crm.dol.bean.EmployeeTask">
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="dispatchid" column="dispatchid"/>
    </resultMap>
    <resultMap class="com.terrence.crm.dol.bean.BaseItem" id="RM.EmployeeTask.BaseItemIncludeqty">
	    <result property="itemname" column="pname"/>
	    <result property="itemcode" column="pcode"/>
	    <result property="formatno" column="formatno"/>
    	<result property="parentqty" column="pqty"/>  
    </resultMap>
    
    <resultMap class="com.terrence.crm.dol.bean.Procedure" id="RM.EmployeeTask.Procedure">
    	<result property="procedurename" column="procedurename"/>  
    </resultMap>
    <resultMap class="com.terrence.crm.dol.bean.Teams" id="RM.EmployeeTask.Teams">
    	<result property="teamname" column="teamname"/>  
    </resultMap>
    <resultMap class="com.terrence.crm.dol.bean.Process" id="RM.EmployeeTask.Process">
    	<result property="processname" column="tprocessname"/>  
    </resultMap>
    <resultMap id="RM.EmployeeTask.Detail" class="com.terrence.crm.dol.bean.EmployeeTask">
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="workid" column="workid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="teamid" column="teamid"/>
        <result property="createtime" column="createtime"/>
        <result property="processid" column="processid"/>
        <result property="fqty" column="fqty"/>
        <result property="processname" column="processname"/>
        <result property="status" column="status"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="prepare" column="prepare"/>
        <result property="planstartdate" column="planstartdate"/>
        <result property="planenddate" column="planenddate"/>
        <result property="finishdate" column="finishdate"/>
        <result property="empid" column="empid"/>
        <result property="deviceid" column="deviceid"/>
        <result property="processmins" column="processmins"/>
        <result property="classtype" column="classtype"/>
        <result property="dispatchid" column="dispatchid"/>
        <result property="firstcheckstatus" column="firstcheckstatus"/>
        <result property="spotcheckstatus" column="spotcheckstatus"/>
        <result property="lastcheckstatus" column="lastcheckstatus"/>
        <result property="itemprocessid" column="itemprocessid"/>
        <result property="centerid" column="centerid"/>
        <result property="process" resultMap="RM.EmployeeTask.Process.Detail"/>
    </resultMap>
    <resultMap id="RM.EmployeeTask.Process.Detail" class="com.terrence.crm.dol.bean.Process">
        <result property="processname" column="pname"/>
        <result property="price" column="price"/>
        <result property="ratio" column="ratio"/>
        <result property="globalratio" column="globalratio"/>
        	
	</resultMap>
    <resultMap id="RM.EmployeeTask.ItemProcess" class="com.terrence.crm.dol.bean.ItemProcess">
        
        <result property="wage" column="itprice"/>  
        <result property="explain" column="explain"/>  
        
         	
	</resultMap>
	
    <resultMap id="RM.EmployeeTask.Admin" class="com.terrence.crm.dol.bean.Admin">
        <result property="adminName" column="adminname"/>  
	</resultMap>
	
	
    
	<resultMap class="com.terrence.crm.dol.bean.EmployeeTask" id="RM.EmployeeTask.PlaEndDate">
		<result property="planenddate" column="planenddate"/>
	</resultMap>
	
	  
	<resultMap id="RM.EmployeeTask.Prepare" class="com.terrence.crm.dol.bean.EmployeeTask">
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="fqty" column="fqty"/>
        <result property="planenddate" column="planenddate"/>
        <result property="empid" column="empid"/>
        <result property="deviceid" column="deviceid"/>
        <result property="processmins" column="processmins"/>
        <result property="classtype" column="classtype"/>
        <result property="prepareEmp" resultMap="RM.PrepareEmp.Left"/>
        <result property="status" column="status"/>
        
        
    </resultMap>
    <resultMap id="RM.PrepareEmp.Left" class="com.terrence.crm.dol.bean.PrepareEmp">
        <result property="preparemins" column="preparemins"/>
        <result property="money" column="money"/>
        <result property="empid" column="prepareemp"/>
    </resultMap>
          
	<resultMap id="RM.EmployeeTask.List" class="com.terrence.crm.dol.bean.EmployeeTask">
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="workid" column="workid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="teamid" column="teamid"/>
        <result property="createtime" column="createtime"/>
        <result property="processid" column="processid"/>
        <result property="fqty" column="fqty"/>
        <result property="processname" column="processname"/>
        <result property="status" column="status"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="prepare" column="prepare"/>
        <result property="planstartdate" column="planstartdate"/>
        <result property="planenddate" column="planenddate"/>
        <result property="finishdate" column="finishdate"/>
        <result property="empid" column="empid"/>
        <result property="deviceid" column="deviceid"/>
        <result property="processmins" column="processmins"/>
        <result property="classtype" column="classtype"/>
        <result property="dispatchid" column="dispatchid"/>
        <result property="firstcheckstatus" column="firstcheckstatus"/>
        <result property="spotcheckstatus" column="spotcheckstatus"/>
        <result property="lastcheckstatus" column="lastcheckstatus"/>
        <result property="itemprocessid" column="itemprocessid"/>
        <result property="centerid" column="centerid"/>
        <result property="baseItem" resultMap="RM.EmployeeTask.BaseItem"/>
        
    </resultMap>
    <resultMap id="RM.EmployeeTask.List2" class="com.terrence.crm.dol.bean.EmployeeTask">
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="workid" column="workid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="teamid" column="teamid"/>
        <result property="createtime" column="createtime"/>
        <result property="processid" column="processid"/>
        <result property="fqty" column="fqty"/>
        <result property="processname" column="processname"/>
        <result property="status" column="status"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="prepare" column="prepare"/>
        <result property="planstartdate" column="planstartdate"/>
        <result property="planenddate" column="planenddate"/>
        <result property="finishdate" column="finishdate"/>
        <result property="empid" column="empid"/>
        <result property="deviceid" column="deviceid"/>
        <result property="processmins" column="processmins"/>
        <result property="classtype" column="classtype"/>
        <result property="dispatchid" column="dispatchid"/>
        <result property="firstcheckstatus" column="firstcheckstatus"/>
        <result property="spotcheckstatus" column="spotcheckstatus"/>
        <result property="lastcheckstatus" column="lastcheckstatus"/>
        <result property="itemprocessid" column="itemprocessid"/>
        <result property="centerid" column="centerid"/>
        <result property="admin" resultMap="RM.EmployeeTask.Admin"/>
    </resultMap>
    
    <resultMap id="RM.EmployeeTask.BaseItem" class="com.terrence.crm.dol.bean.BaseItem">
        <result property="formatno" column="formatno"/>
        
    </resultMap>
    
    
    <resultMap id="RM.EmployeeTask.listToempTask" class="com.terrence.crm.dol.bean.EmployeeTask">
    	<result property="employeetaskid" column="employeetaskid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="fqty" column="fqty"/>
        <result property="status" column="status"/>
        <result property="planstartdate" column="planstartdate"/>
        <result property="planenddate" column="planenddate"/>
        <result property="itemprocess" resultMap="RM.EmployeeTask.ItemProcess.explain"/>
        <result property="admin" resultMap="RM.EmployeeTask.Admin"/>
        <result property="teams" resultMap="RM.EmployeeTask.Teams"/>
        <result property="fbillno" column="fbillno"/>
        
    </resultMap>
    
    <resultMap id="RM.EmployeeTask.ItemProcess.explain" class="com.terrence.crm.dol.bean.ItemProcess">
        <result property="explain" column="explain"/>  
	</resultMap>
    
    
    <resultMap  id="RM.EmployeeTask.EpListDetail" class="com.terrence.crm.dol.bean.EmployeeTask">
    	<result property="employeetaskid" column="employeetaskid"/>
    	<result property="centerid" column="centerid"/>  
    	<result property="deviceid" column="deviceid"/> 
    	<result property="status" column="status"/> 
    	<result property="teamid" column="teamid"/> 
    	 <result property="itemprocedureid" column="itemprocedureid"/> 
    	 <result property="itemprocessid" column="itemprocessid"/> 
    	 <result property="processmins" column="processmins"/>
    	 <result property="preparemins" column="preparemins"/>
    	  
    	 
    	<result property="empid" column="empid"/> 
    	<result property="fqty" column="fqty"/> 
    	<result property="planstartdate" column="planstartdate"/> 
    	<result property="planenddate" column="planenddate"/> 
    	<result property="prepareEmp" resultMap="RM.EmployeeTask.EpListDetail.prepareEmp"/> 
    	<result property="seqno" column="seqno"/>
    	
    	<result property="admin" resultMap="RM.EmployeeTask.Admin"/>
    	<result property="device" resultMap="RM.EmployeeTask.device"/>
    	<result property="process" resultMap="RM.EmployeeTask.EpListDetail.process"/>
    	<result property="procedure" resultMap="RM.EmployeeTask.EpListDetail.procedure"/>
    </resultMap>
    <resultMap id="RM.EmployeeTask.EpListDetail.process" class="com.terrence.crm.dol.bean.Process">
        <result property="processname" column="pname"/>
	</resultMap>
    <resultMap id="RM.EmployeeTask.EpListDetail.procedure" class="com.terrence.crm.dol.bean.Procedure">
        <result property="procedurerid" column="procedurerid"/>
        <result property="procedurename" column="procedurename"/>
	</resultMap>
    <resultMap id="RM.EmployeeTask.device" class="com.terrence.crm.dol.bean.Device">
        <result property="devicename" column="devicename"/>
	</resultMap>
	<resultMap id="RM.EmployeeTask.EpListDetail.prepareEmp" class="com.terrence.crm.dol.bean.PrepareEmp">
        <result property="empid" column="preparempid"/>
	</resultMap>
	
	<resultMap id="RM.EmployeeTaskDevice" class="com.terrence.crm.dol.bean.EmployeeTask">
		<result property="employeetaskid" column="employeetaskid"/> 
		<result property="itemcode" column="itemcode"/> 
		<result property="itemname" column="itemname"/> 
		<result property="fqty" column="fqty"/> 
		<result property="status" column="status"/> 
		<result property="planstartdate" column="planstartdate"/> 
		<result property="planenddate" column="planenddate"/> 
		<result property="empid" column="empid"/>
		<result property="admin" resultMap="RM.EmployeeTask.Admin"/>
	</resultMap>
	
	
	<resultMap id="RM.EmployeeTask.devicework.list"  class="com.terrence.crm.dol.bean.EmployeeTask" >
		<result property="runtime" column="runtime"/> 
		<result property="workmonth" column="workmonth"/> 
	</resultMap>
	
	<!--  -->
    <resultMap  id="RM.EmployeeTask.EpListDetailCard" class="com.terrence.crm.dol.bean.EmployeeTask">
    	<result property="employeetaskid" column="employeetaskid"/>
    	<result property="centerid" column="centerid"/>  
    	<result property="deviceid" column="deviceid"/> 
    	<result property="status" column="status"/> 
    	<result property="teamid" column="teamid"/> 
    	 <result property="itemprocedureid" column="itemprocedureid"/> 
    	 <result property="itemprocessid" column="itemprocessid"/> 
    	 <result property="processmins" column="processmins"/>
    	 <result property="preparemins" column="preparemins"/>
    	 
    	<result property="empid" column="empid"/> 
    	<result property="fqty" column="fqty"/> 
    	<result property="planstartdate" column="planstartdate"/> 
    	<result property="planenddate" column="planenddate"/> 
    	<result property="prepareEmp" resultMap="RM.EmployeeTask.EpListDetail.prepareEmp"/> 
    	<result property="seqno" column="seqno"/>
    	
    	<result property="admin" resultMap="RM.EmployeeTask.Admin"/>
    	<result property="device" resultMap="RM.EmployeeTask.device"/>
    	<result property="process" resultMap="RM.EmployeeTask.EpListDetail.process"/>
    	<result property="procedure" resultMap="RM.EmployeeTask.EpListDetail.procedure"/>
    	<result property="checklist" column="employeetaskid" select="RM.EmployeeTask.findchecklist"/>
    	<result property="startdate" column="startdate"/>
    	
    	
    </resultMap>
	
    <resultMap  id="RM.EmployeeTask.checks" class="com.terrence.crm.dol.bean.Check">
    	<result property="acceptnum" column="acceptnum"/>
    	<result property="operationdiscardnum" column="operationdiscardnum"/>
    	<result property="itemdiscardnum" column="itemdiscardnum"/>
    	<result property="repairnum" column="repairnum"/>
    	<result property="createtime" column="createtime"/>
    	<result property="checktime" column="checktime"/>
    	<result property="receviernum" column="receivernum"/>
    	
    </resultMap>	
	
    
    <resultMap id="RM.EmployeeTask.IncludeIcmo" class="com.terrence.crm.dol.bean.EmployeeTask">
        <result property="employeetaskid" column="employeetaskid"/>
        <result property="workid" column="workid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="teamid" column="teamid"/>
        <result property="createtime" column="createtime"/>
        <result property="processid" column="processid"/>
        <result property="fqty" column="fqty"/>
        <result property="processname" column="processname"/>
        <result property="status" column="status"/>
        <result property="acceptnum" column="acceptnum"/>
        <result property="prepare" column="prepare"/>
        <result property="planstartdate" column="planstartdate"/>
        <result property="planenddate" column="planenddate"/>
        <result property="finishdate" column="finishdate"/>
        <result property="empid" column="empid"/>
        <result property="deviceid" column="deviceid"/>
        <result property="processmins" column="processmins"/>
        <result property="classtype" column="classtype"/>
        <result property="dispatchid" column="dispatchid"/>
        <result property="firstcheckstatus" column="firstcheckstatus"/>
        <result property="spotcheckstatus" column="spotcheckstatus"/>
        <result property="lastcheckstatus" column="lastcheckstatus"/>
        <result property="itemprocessid" column="itemprocessid"/>
        <result property="centerid" column="centerid"/>
        <result property="itemprocess" resultMap="RM.EmployeeTask.ItemProcess"/>
        <result property="admin" resultMap="RM.EmployeeTask.Admin"/>
        <result property="procedure" resultMap="RM.EmployeeTask.Procedure"/>
        <result property="teams" resultMap="RM.EmployeeTask.Teams"/>
        <result property="process" resultMap="RM.EmployeeTask.Process"/>
        <result property="listbaseItem" column="itemcode" select="RM.EmployeeTask.selectparent"/>        
        <result property="icmo" resultMap="RM.EmployeeTask.Icmo"/>
        <result property="preorder" column="preorder"/>
        <result property="isreqtake" column="isreqtake"/>
        <result property="workplanStatus" column="workplanStatus" />
        
    </resultMap>
    
    <resultMap class="com.terrence.crm.dol.bean.Icmo" id="RM.EmployeeTask.Icmo">
    	<result property="fbillno" column="fbillno"/>
    </resultMap>
    
    
    <resultMap class="com.terrence.crm.dol.bean.EmployeeTask" id="EmployeeTask.getreqtakefqty">
    	<result property="fqty" column="fqty"/>
    </resultMap>
    
    
	<!-- 用于select查询公用抽取的列 -->
	<sql id="EmployeeTask.columns">
	    <![CDATA[
        	t_employee_task.employeetaskid ,
        	t_employee_task.workid ,
        	t_employee_task.itemcode ,
        	t_employee_task.itemname ,
        	t_employee_task.teamid ,
        	t_employee_task.createtime ,
        	t_employee_task.processid ,
        	t_employee_task.fqty ,
        	t_employee_task.processname ,
        	t_employee_task.status ,
        	t_employee_task.acceptnum ,
        	t_employee_task.prepare ,
        	t_employee_task.planstartdate ,
        	t_employee_task.planenddate ,
        	t_employee_task.finishdate ,
        	t_employee_task.empid ,
        	t_employee_task.deviceid ,
        	t_employee_task.processmins ,
        	t_employee_task.classtype ,
        	t_employee_task.dispatchid ,
        	t_employee_task.firstcheckstatus ,
        	t_employee_task.spotcheckstatus ,
        	t_employee_task.lastcheckstatus ,
        	t_employee_task.itemprocessid ,
        	t_employee_task.centerid 
	    ]]>
	</sql>
	
   <insert id="EmployeeTask.insert" >
    <![CDATA[
        INSERT INTO
        t_employee_task (
        	workid ,
        	itemcode ,
        	itemname ,
        	teamid ,
        	createtime ,
        	processid ,
        	fqty ,
        	status ,
        	acceptnum ,
        	planenddate ,
        	empid ,
        	deviceid ,
        	processmins ,
        	classtype ,
        	dispatchid ,
        	itemprocessid ,
        	centerid 
        ) VALUES (
        	#workid# ,
        	#itemcode# ,
        	#itemname# ,
        	#teamid# ,
        	#createtime# ,
        	#processid# ,
        	#fqty# ,
        	#status# ,
        	#acceptnum# ,
        	#planenddate# ,
        	#empid# ,
        	#deviceid# ,
        	#processmins# ,
        	#classtype# ,
        	#dispatchid# ,
        	#itemprocessid# ,
        	#centerid# 
        )
    ]]> 
        
    <!--
    mysql:		type="post" SELECT  select last_insert_id()
    sqlserver:	type="post" SELECT  @@identity  AS  ID
    oracle:		type="pre" 	SELECT  sequenceName.nextval AS ID FROM DUAL
    DB2:		type="pre"	values nextval for sequenceName
    -->
        <selectKey resultClass="java.lang.Long" type="post" keyProperty="employeetaskid" >
            SELECT  @@identity  AS  ID
        </selectKey>
    </insert>
    <insert id="EmployeeTask.insertIncludeStartDate" >
    
        INSERT INTO
        t_employee_task (
        	workid ,
        	itemcode ,
        	itemname ,
        	teamid ,
        	createtime ,
        	processid ,
        	fqty ,
        	status ,
        	acceptnum ,
        	planenddate ,
        	planstartdate ,
        	empid ,
        	deviceid ,
        	processmins ,
        	classtype ,
        	dispatchid ,
        	itemprocessid ,
        	centerid
        	<isNotEmpty prepend="," property="devtaskid">
        	devtaskid
        	</isNotEmpty>
        	
        ) VALUES (
        	#workid# ,
        	#itemcode# ,
        	#itemname# ,
        	#teamid# ,
        	#createtime# ,
        	#processid# ,
        	#fqty# ,
        	#status# ,
        	#acceptnum# ,
        	#planenddate# ,
        	#planstartdate# ,
        	#empid# ,
        	#deviceid# ,
        	#processmins# ,
        	#classtype# ,
        	#dispatchid# ,
        	#itemprocessid# ,
        	#centerid# 
        	<isNotEmpty prepend="," property="devtaskid">
        	#devtaskid#
        	</isNotEmpty>
        )
     

     
    <!--
    mysql:		type="post" SELECT  select last_insert_id()
    sqlserver:	type="post" SELECT  @@identity  AS  ID
    oracle:		type="pre" 	SELECT  sequenceName.nextval AS ID FROM DUAL
    DB2:		type="pre"	values nextval for sequenceName
    -->
        <selectKey resultClass="java.lang.Long" type="post" keyProperty="employeetaskid" >
            SELECT  @@identity  AS  ID
        </selectKey>
    </insert>
    
    
    
    <!-- 更新物料工艺，级联更新个人任加工时长 -->
	<update id="EmpoyeeTask.update.foritemprocess" parameterClass="com.terrence.crm.dol.bean.EmployeeTask">
	update t_employee_task set processmins= t_item_process.processmins from t_item_process 
	where t_item_process.itemprocessid=t_employee_task.itemprocessid 
	and datename(yyyy,createtime)+datename(mm,createtime)=#yearMonth# and t_employee_task.itemprocessid=#itemprocessid#
	</update>
	
	<update id="EmpoyeeTask.update.updateTofinish">
	update t_employee_task set status=2
	where dispatchid=#dispatchid#
	</update>
	
	<update id="EmployeeTask.update" parameterClass="com.terrence.crm.dol.bean.EmployeeTask">         
        UPDATE t_employee_task 
        <dynamic prepend="SET">
	        <isNotEmpty prepend="," property="workid">
	        	workid = #workid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	itemcode = #itemcode# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	itemname = #itemname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="teamid">
	        	teamid = #teamid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="createtime">
	        	createtime = #createtime# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="processid">
	        	processid = #processid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty">
	        	fqty = #fqty# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="processname">
	        	processname = #processname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="status">
	        	status = #status# 
	        </isNotEmpty>
	       
	        <isNotEmpty prepend="," property="acceptnum">
	        	acceptnum = #acceptnum# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="prepare">
	        	prepare = #prepare# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="planstartdate">
	        	planstartdate = #planstartdate# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="planenddate">
	        	planenddate = #planenddate# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="finishdate">
	        	finishdate = #finishdate# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="empid">
	        	empid = #empid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="deviceid">
	        	deviceid = #deviceid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="processmins">
	        	processmins = #processmins# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="classtype">
	        	classtype = #classtype# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="dispatchid">
	        	dispatchid = #dispatchid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="firstcheckstatus">
	        	firstcheckstatus = #firstcheckstatus# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="spotcheckstatus">
	        	spotcheckstatus = #spotcheckstatus# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="lastcheckstatus">
	        	lastcheckstatus = #lastcheckstatus# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemprocessid">
	        	itemprocessid = #itemprocessid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="centerid">
	        	centerid = #centerid# 
	        </isNotEmpty>
	    </dynamic>
        WHERE 
	        employeetaskid = #employeetaskid# 
    </update>
    
	<delete id="EmployeeTask.delete" parameterClass="java.lang.Long">
    <![CDATA[
        delete from t_employee_task where
       employeetaskid = #employeetaskid# 
    ]]>
    </delete>
    
    <delete id="EmployeeTask.deleteMultiple">
    <![CDATA[
        DELETE FROM 
        	t_employee_task 
        WHERE
       employeetaskid in ($employeetaskid$) 
    ]]>
    </delete>
    
    <select id="EmployeeTask.getById" resultMap="RM.EmployeeTask.Detail">
	    select <include refid="EmployeeTask.columns"/>,t_process_bj.processname as pname,t_process_bj.price,t_process_bj.ratio,t_process_bj.globalratio	    
	        from t_employee_task , t_process_bj 
	    
	        where 
		        employeetaskid = #employeetaskid# and t_employee_task.centerid=t_process_bj.processid
	    
    </select>
    <select id="EmployeeTask.getByEmployeeTaskId" resultMap="RM.EmployeeTask.Edid">
	    select t_employee_task.dispatchid, t_employee_task.employeetaskid from t_employee_task where employeetaskid = #employeetaskid#
	    
    </select>
	<select id="EmployeeTask.getByProperty" resultMap="RM.EmployeeTask">
		select <include refid="EmployeeTask.columns"/> from t_employee_task where $propertyName$=#propertyValue#
	</select>
	
	<sql id="EmployeeTask.findPage.where">
	    <dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="employeetaskid">
	             t_employee_task.employeetaskid = #employeetaskid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="workid">
	             t_employee_task.workid = #workid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemcode">
	             t_employee_task.itemcode like ('%$itemcode$%')
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemname">
	             t_employee_task.itemname like ('%$itemname$%')
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="teamid">
	             t_employee_task.teamid = #teamid#
	       </isNotEmpty>
	      
			<isNotEmpty prepend="AND" property="createtimeBegin">
	             t_employee_task.createtime &gt;= #createtimeBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="createtimeEnd">
	             t_employee_task.createtime &lt;= #createtimeEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="processid">
	             t_employee_task.processid = #processid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fqty">
	             t_employee_task.fqty = #fqty#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="processname">
	             t_employee_task.processname = #processname#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="status">
	             t_employee_task.status = #status#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="notinstatus">
	             t_employee_task.status != #notinstatus#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="acceptnum">
	             t_employee_task.acceptnum = #acceptnum#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="prepare">
	             t_employee_task.prepare = #prepare#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="planstartdateBegin">
	             t_employee_task.planstartdate &gt;= #planstartdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="planstartdateEnd">
	             t_employee_task.planstartdate &lt;= #planstartdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="planenddateBegin">
	             t_employee_task.planenddate &gt;= #planenddateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="planenddateEnd">
	             t_employee_task.planenddate &lt;= #planenddateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="finishdateBegin">
	             t_employee_task.finishdate &gt;= #finishdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="finishdateEnd">
	             t_employee_task.finishdate &lt;= #finishdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="empid">
	             t_employee_task.empid = #empid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="deviceid">
	             t_employee_task.deviceid = #deviceid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="processmins">
	             t_employee_task.processmins = #processmins#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="classtype">
	             t_employee_task.classtype = #classtype#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dispatchid">
	             t_employee_task.dispatchid = #dispatchid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="states">
	             t_employee_task.status in ($states$)
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="notemptaskid">
	       		 t_employee_task.employeetaskid!=#notemptaskid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="firstcheckstatus">
	             t_employee_task.firstcheckstatus = #firstcheckstatus#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="spotcheckstatus">
	             t_employee_task.spotcheckstatus = #spotcheckstatus#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="lastcheckstatus">
	             t_employee_task.lastcheckstatus = #lastcheckstatus#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="itemprocessid">
	             t_employee_task.itemprocessid = #itemprocessid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="centerid">
	             t_employee_task.centerid = #centerid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="preorder">
    	   		 t_dispatch_work.preorder=#preorder#
    	   </isNotEmpty>
	       
	    </dynamic>	
	</sql>
	 
    <sql id="EmployeeTask.findPage.and">
			<isNotEmpty prepend="AND" property="employeetaskid">
	             t_employee_task.employeetaskid = #employeetaskid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="workid">
	             t_employee_task.workid = #workid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="itemcode">
	             t_employee_task.itemcode like ('%$itemcode$%')
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="itemname">
	             t_employee_task.itemname like ('%$itemname$%')
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="teamid">
	             t_employee_task.teamid = #teamid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="createtimeBegin">
	             t_employee_task.createtime &gt;= #createtimeBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="createtimeEnd">
	             t_employee_task.createtime &lt;= #createtimeEnd#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="processid">
	             t_employee_task.processid = #processid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="fqty">
	             t_employee_task.fqty = #fqty#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="processname">
	             t_employee_task.processname = #processname#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="status">
	             t_employee_task.status = #status#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="notinstatus">
	             t_employee_task.status != #notinstatus#
	       </isNotEmpty>
	       
	       
			<isNotEmpty prepend="AND" property="acceptnum">
	             t_employee_task.acceptnum = #acceptnum#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="prepare">
	             t_employee_task.prepare = #prepare#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="planstartdateBegin">
	             t_employee_task.planstartdate &gt;= #planstartdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="planstartdateEnd">
	             t_employee_task.planstartdate &lt;= #planstartdateEnd#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="planenddateBegin">
	             t_employee_task.planenddate &gt;= #planenddateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="planenddateEnd">
	             t_employee_task.planenddate &lt;= #planenddateEnd#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="finishdateBegin">
	             t_employee_task.finishdate &gt;= #finishdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="finishdateEnd">
	             t_employee_task.finishdate &lt;= #finishdateEnd#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="empid">
	             t_employee_task.empid = #empid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="deviceid">
	             t_employee_task.deviceid = #deviceid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="processmins">
	             t_employee_task.processmins = #processmins#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="classtype">
	             t_employee_task.classtype = #classtype#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dispatchid">
	             t_employee_task.dispatchid = #dispatchid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="firstcheckstatus">
	             t_employee_task.firstcheckstatus = #firstcheckstatus#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="spotcheckstatus">
	             t_employee_task.spotcheckstatus = #spotcheckstatus#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="lastcheckstatus">
	             t_employee_task.lastcheckstatus = #lastcheckstatus#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="itemprocessid">
	             t_employee_task.itemprocessid = #itemprocessid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="centerid">
	             t_employee_task.centerid = #centerid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="preorder">
    	   		 t_dispatch_work.preorder=#preorder#
    	   </isNotEmpty>
	       
	</sql>
    <select id="EmployeeTask.getMaxPlanEndDate" resultMap="RM.EmployeeTask.PlaEndDate">
    	select max(planenddate) planenddate from t_employee_task <include refid="EmployeeTask.findPage.where"/>
    </select>
    <select id="EmployeeTask.findList" resultMap="RM.EmployeeTask.List">
    	SELECT 
    		<include refid="EmployeeTask.columns"/>,t_base_item.formatno 	    
	        
    	FROM 
    		t_employee_task left join t_base_item on  t_employee_task.itemcode=t_base_item.itemcode
		<include refid="EmployeeTask.findPage.where"/>
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    <select id="EmployeeTask.findList.devicework" resultMap="RM.EmployeeTask.devicework.list">
    <!-- getWorkmonth///deviceid -->
    	select workdate workmonth,sum(runtime) runtime from 
    	t_device_work where deviceid=#deviceid# 
    	and SUBSTRING(workdate,0,8)=SUBSTRING(#workmonth#,0,5)+'-'+SUBSTRING(#workmonth#,5,7) 
    	group by workdate
    </select>
    
    
    <select id="EmployeeTask.findListdetail" resultMap="RM.EmployeeTask.List2" >
     SELECT <include refid="EmployeeTask.columns"/> ,t_admin.adminname

        	FROM 
    		t_employee_task left join t_admin on  t_employee_task.empid=t_admin.adminid
		<include refid="EmployeeTask.findPage.where"/>
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
  </select>  
    
    <select id="EmployeeTask.findPage.count" resultClass="long">
    <![CDATA[
           select 
        count(*)
        from t_employee_task
    ]]>
    left join t_dispatch_work on t_employee_task.dispatchid=t_dispatch_work.id
		<include refid="EmployeeTask.findPage.where"/>    
    </select>
    
    <select id="EmployeeTask.listToempTask.count" resultClass="long">
    <![CDATA[
           select 
        count(*)
        from t_employee_task,t_icmo
         
        
    ]]>
   		 where t_employee_task.workid=t_icmo.icmoid
		<isNotEmpty  property="fbillno"> and
	             t_icmo.fbillno like ('%$fbillno$%')
	       </isNotEmpty> 
		<include refid="EmployeeTask.findPage.and"/>
		    
    </select>
    
    <select id="EmployeeTask.findPage.device.count" resultClass="long">
    <![CDATA[
           select 
        count(*)
        from t_employee_task
    ]]>
		where 
			deviceid=#deviceid#
			 
	<isNotEmpty property="workmonth">  and
		 #workmonth# 
				between 
					datename(yyyy,planstartdate)+datename(mm,planstartdate)+case len(datename(dd,planstartdate))
			 		when 1 then '0'+datename(dd,planstartdate) else datename(dd,planstartdate) end
			 	and 
			 		datename(yyyy,planenddate)+datename(mm,planenddate)+case len(datename(dd,planenddate))
				 	when 1 then '0'+datename(dd,planenddate) else datename(dd,planenddate) end
		</isNotEmpty>
	<include refid="EmployeeTask.findPage.and"/>	
    </select>
    
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
  
    <select id="EmployeeTask.findPage" resultMap="RM.EmployeeTask">
    	select <include refid="EmployeeTask.columns"/>	    
	        from t_employee_task 	   
		<include refid="EmployeeTask.findPage.where"/>		
		<isNotEmpty property="sortColumns">ORDER BY $sortColumns$</isNotEmpty>
		
    </select>
      -->
   
	<select id="EmployeeTask.findPage" resultMap="RM.EmployeeTask.IncludeIcmo">
    	select <include refid="EmployeeTask.columns"/>,
	      t_procedure.procedurename,t_teams.teamname,t_item_process.wage as itprice, t_item_process.explain,
    	  t_admin.adminName,t_process_bj.processname as tprocessname  
    	  ,t_icmo.fbillno
    	  ,t_work_plan.matchstatus workplanStatus
    	  ,t_icmo.isreqtake,    	  
    	  t_dispatch_work.preorder
    	  from 
    	  t_employee_task 
    	  left join t_procedure on t_employee_task.processid=t_procedure.procedurerid 
    	  left join t_item_process on t_employee_task.itemprocessid=t_item_process.itemprocessid
    	  left join t_admin on t_employee_task.empid=t_admin.adminid
    	  left join t_teams on t_employee_task.teamid=t_teams.teamid 
    	  left join t_process_bj on t_employee_task.centerid=t_process_bj.processid
 		  left join t_icmo on 	t_employee_task.workid=t_icmo.icmoid
 		  left join t_dispatch_work on t_employee_task.dispatchid=t_dispatch_work.id
 		  left join t_work_plan on t_icmo.fbillno=t_work_plan.fbillno 
    	   where 1=1
    	   
	   <isNotEmpty property="notTop">  and 
       employeetaskid  not in(select $notTop$ employeetaskid 
	  		 from  
				 t_employee_task
    	    <include refid="EmployeeTask.findPage.where"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="EmployeeTask.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
	
		<select id="EmployeeTask.listToempTask" resultMap="RM.EmployeeTask.listToempTask">
			select t_icmo.fbillno,t_employee_task.employeetaskid, t_employee_task.itemcode,t_employee_task.itemname,t_teams.teamname,t_admin.adminname,	t_item_process.explain,
							t_employee_task.planstartdate,
				t_employee_task.planenddate,t_employee_task.fqty,t_employee_task.status					
			  from t_employee_task
				left join t_teams on t_employee_task.teamid=t_teams.teamid
				left join t_admin on t_employee_task.empid=t_admin.adminid
				left join t_item_process on t_employee_task.itemprocessid=t_item_process.itemprocessid
				,t_icmo
    	   where 1=1
    	   and t_employee_task.workid=t_icmo.icmoid
    	   <isNotEmpty  property="fbillno"> and
	             t_icmo.fbillno like ('%$fbillno$%')
	       </isNotEmpty>
	   <isNotEmpty property="notTop">  and 
       employeetaskid  not in(select $notTop$ employeetaskid 
	  		 from  
				 t_employee_task,t_icmo
				 where 1=1
				 and t_employee_task.workid=t_icmo.icmoid
				 <isNotEmpty  property="fbillno"> and
	             t_icmo.fbillno like ('%$fbillno$%')
	       		</isNotEmpty>
    	    <include refid="EmployeeTask.findPage.and"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="EmployeeTask.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
	
	
		<select id="EmployeeTask.findPage.device" resultMap="RM.EmployeeTaskDevice">
    	select 
    	    t_employee_task.employeetaskid ,
        	t_employee_task.itemcode ,
        	t_employee_task.itemname ,
        	t_employee_task.fqty ,
        	t_employee_task.status ,
        	t_employee_task.planstartdate ,
        	t_employee_task.planenddate ,
        	t_employee_task.empid ,
        	t_admin.adminname
        	from 
        	t_employee_task
        		left join t_admin on empid=t_admin.adminid
    	   where 
    	  	 deviceid=#deviceid#
		<isNotEmpty property="workmonth">  and
		 #workmonth# 
				between 
					datename(yyyy,planstartdate)+datename(mm,planstartdate)+case len(datename(dd,planstartdate))
			 		when 1 then '0'+datename(dd,planstartdate) else datename(dd,planstartdate) end
			 	and 
			 		datename(yyyy,planenddate)+datename(mm,planenddate)+case len(datename(dd,planenddate))
				 	when 1 then '0'+datename(dd,planenddate) else datename(dd,planenddate) end
		</isNotEmpty>		
				
	   <isNotEmpty property="notTop">  and 
       employeetaskid  not in(select $notTop$ employeetaskid 
	  		 from  
				 t_employee_task
    	    where
    	  	 deviceid=#deviceid#
			<isNotEmpty property="workmonth">  and
		 		#workmonth# 
				between 
					datename(yyyy,planstartdate)+datename(mm,planstartdate)+case len(datename(dd,planstartdate))
			 		when 1 then '0'+datename(dd,planstartdate) else datename(dd,planstartdate) end
			 	and 
			 		datename(yyyy,planenddate)+datename(mm,planenddate)+case len(datename(dd,planenddate))
				 	when 1 then '0'+datename(dd,planenddate) else datename(dd,planenddate) end
			</isNotEmpty>
			<include refid="EmployeeTask.findPage.and"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="EmployeeTask.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
	
	
	
<!-- 	<select id="EmployeeTask.findPage" resultMap="RM.EmployeeTask">
    	select <include refid="EmployeeTask.columns"/>,t_process_bj.processname as pname	    
	        from t_employee_task , t_process_bj where t_employee_task.processid=t_process_bj.processid 
	        
	   
	   	<include refid="EmployeeTask.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    --> 
	<select id="EmployeeTask.findDetail" resultMap="RM.EmployeeTask.Prepare">
    select t_employee_task.employeetaskid,t_employee_task.classtype,t_employee_task.deviceid,t_employee_task.empid,
    t_employee_task.status,
	t_employee_task.processmins,t_employee_task.fqty,t_employee_task.planenddate,t_prepare_emp.preparemins,t_prepare_emp.money,
	t_prepare_emp.empid as prepareemp from t_employee_task left join t_prepare_emp on t_employee_task.employeetaskid=t_prepare_emp.employeetaskid 
	<include refid="EmployeeTask.findPage.where"/>
    </select>
    
    
	<select id="RM.EmployeeTask.selectparent" resultMap="RM.EmployeeTask.BaseItemIncludeqty">
    	select t_order_bom.parentcode as pcode
    	,t_order_bom.parentname as pname, t_order_bom.parentqty as pqty ,t_base_item.formatno as formatno
    	 from t_order_bom left join t_base_item on  t_order_bom.parentcode=t_base_item.itemcode
    	 	where t_order_bom.itemcode=#itemcode#
    </select>
    
	
	<select id="RM.EmployeeTask.findEpList" resultMap="RM.EmployeeTask.EpListDetail">
	select t_employee_task.employeetaskid
	,t_employee_task.centerid
	,t_employee_task.deviceid
	,t_employee_task.empid
	,t_employee_task.fqty
	,t_employee_task.status
	,t_employee_task.preparempid
	,t_dispatch_work.processid procedurerid
	,t_procedure.procedurename 
	,t_process_bj.processname pname
	,t_device.devicename devicename
	,t_admin.adminname
	,t_employee_task.planstartdate
	,t_employee_task.planenddate
	,t_employee_task.teamid
	,t_employee_task.itemprocedureid
	,t_employee_task.itemprocessid
	,t_employee_task.processmins
	,t_employee_task.seqno
	,t_employee_task.preparemins
	
	from t_dispatch_work right join (select 
		c.employeetaskid
		,c.dispatchid
		,c.centerid
		,c.deviceid
		,c.empid
		,c.fqty
		,c.status
		,c.planstartdate
		,c.planenddate
		,t_prepare_emp.empid preparempid
		,c.workid
		,c.teamid
		,t_item_process.itemprocedureid
		,c.itemprocessid
		,c.processmins
		,t_item_procedure.seqno
		,t_item_process.preparemins
	 from t_employee_task c left join t_prepare_emp on c.employeetaskid=t_prepare_emp.employeetaskid
	 left join t_item_process on c.itemprocessid = t_item_process.itemprocessid
	 left join t_item_procedure on t_item_process.itemprocedureid = t_item_procedure.itemprocedureid
	 
	 where c.workid=#workid# 
	 ) t_employee_task 
	on t_dispatch_work.id=t_employee_task.dispatchid 
		left join t_process_bj on t_dispatch_work.centerid=t_process_bj.processid
		left join t_device on t_employee_task.deviceid=t_device.deviceid
		left join t_admin on 	t_employee_task.empid=t_admin.adminid	
		left join t_procedure on 	t_dispatch_work.processid=	t_procedure.procedurerid
		
	where t_dispatch_work.workid=#workid# order by preorder
	</select>
    
    
    <select id="RM.EmployeeTask.findEpListCard" resultMap="RM.EmployeeTask.EpListDetailCard">
	select t_employee_task.employeetaskid
	,t_employee_task.centerid
	,t_employee_task.deviceid
	,t_employee_task.empid
	,t_employee_task.fqty
	,t_employee_task.status
	,t_employee_task.preparempid
	,t_dispatch_work.processid procedurerid
	,t_procedure.procedurename 
	,t_process_bj.processname pname
	,t_device.devicename devicename
	,t_admin.adminname
	,t_employee_task.planstartdate
	,t_employee_task.planenddate
	,t_employee_task.finishdate
	,t_employee_task.teamid
	,t_employee_task.itemprocedureid
	,t_employee_task.itemprocessid
	,t_employee_task.processmins
	,t_employee_task.seqno
	,t_employee_task.preparemins
	,t_employee_task.startdate
	
	from t_dispatch_work right join (select 
		c.employeetaskid
		,c.dispatchid
		,c.centerid
		,c.deviceid
		,c.empid
		,c.fqty
		,c.status
		,c.planstartdate
		,c.planenddate
		,c.finishdate
		,c.startdate
		,t_prepare_emp.empid preparempid
		,c.workid
		,c.teamid
		,t_item_process.itemprocedureid
		,c.itemprocessid
		,c.processmins
		,t_item_procedure.seqno
		,t_item_process.preparemins
	 from t_employee_task c left join t_prepare_emp on c.employeetaskid=t_prepare_emp.employeetaskid
	 left join t_item_process on c.itemprocessid = t_item_process.itemprocessid
	 left join t_item_procedure on t_item_process.itemprocedureid = t_item_procedure.itemprocedureid
	 
	 where c.workid=#workid# 
	 ) t_employee_task 
	on t_dispatch_work.id=t_employee_task.dispatchid 
		left join t_process_bj on t_dispatch_work.centerid=t_process_bj.processid
		left join t_device on t_employee_task.deviceid=t_device.deviceid
		left join t_admin on 	t_employee_task.empid=t_admin.adminid	
		left join t_procedure on 	t_dispatch_work.processid=	t_procedure.procedurerid
	where t_dispatch_work.workid=#workid# order by preorder
	</select>
   
	<select id="RM.EmployeeTask.findchecklist" resultMap="RM.EmployeeTask.checks">
		select 
			t_check_record.acceptnum acceptnum
			,t_check_record.workdiscard operationdiscardnum
			,t_check_record.itemdiscard itemdiscardnum
			,t_check_record.repairnum  repairnum
			,t_check_record.createtime
			,t_check_record.checktime
			,t_check_record.receivernum
			
	 	from 
			 t_check_record where t_check_record.employeetaskid=#employeetaskid#
			 and checktype!=1
			 
			 
	</select>    

	
	<select id="EmployeeTask.getreqtakefqty" resultMap="EmployeeTask.getreqtakefqty">
		select sum(fqty) fqty
		from t_employee_task
		where devtaskid=#devtaskid#
		group by devtaskid
		
	</select>

	





	
	
    
</sqlMap>
