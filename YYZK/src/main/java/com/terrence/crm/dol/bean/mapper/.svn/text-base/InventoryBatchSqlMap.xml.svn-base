<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="InventoryBatch">

        
	<resultMap id="RM.InventoryBatch" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
    </resultMap>
    
    <resultMap id="RM.InventoryBatch.callslip" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
        <result property="stockname" column="stockname"/>
    </resultMap>
    
    <resultMap id="RM.InventoryBatch.getByDetail" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fqty" column="fqty"/>
    </resultMap>
    <resultMap id="RM.InventoryBatch.includePosition" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
        <result property="positions" resultMap="RM.InventoryBatch.positions"/>
        <result property="baseItem" resultMap="RM.InventoryBatch.BaseItem2"/>
    </resultMap>
    <resultMap class="com.terrence.crm.dol.bean.BaseItem" id="RM.InventoryBatch.BaseItem2">
    	<result property="makingnums" column="makingnums"/>
        <result property="existdemand" column="existdemand"/>
        <result property="checkednum" column="checkednum"/>
        <result property="cycleid" column="cycleid"/>
        <result property="itemproperty" column="itemproperty"/>
        <result property="youtput" column="youtput"/>
    </resultMap>
    
     <resultMap class="com.terrence.crm.dol.bean.BaseItem" id="RM.InventoryBatch.BaseItem2.NewData">
    	<result property="makingnums" column="makingnums"/>
        <result property="existdemand" column="existdemand"/>
        <result property="checkednum" column="checkednum"/>
        <result property="cycleid" column="cycleid"/>
        <result property="itemproperty" column="itemproperty"/>
        <result property="youtput" column="youtput"/>
        <result property="fissnmanager" column="fissnmanager"/>
        <result property="makingnums4" column="makingnums4"/>
        
        <result property="existdemand4" column="existdemand4"/>
        <result property="planfqty" column="planfqty"/>
        <result property="planfqty4" column="planfqty4"/>
    </resultMap>
    
    
    <resultMap id="RM.InventoryBatch.positions" class="com.terrence.crm.dol.bean.Positions">
        <result property="positionname" column="positionname"/>
        <result property="positionid" column="positionid"/>
    </resultMap>
    
    
	<resultMap id="RM.InventoryBatch.BaseItem" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
        <result property="baseItem" resultMap="RM.InventoryBatch.BaseItem.Detail"/>
    </resultMap>
	<resultMap id="RM.InventoryBatch.BaseItem.Detail" class="com.terrence.crm.dol.bean.BaseItem">
	<result property="isbatch" column="isbatch"/>
	<result property="fissnmanager" column="fissnmanager"/>
	</resultMap>  


	<resultMap id="RM.InventoryBatch.uninclude0" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="stockname" column="stockname"/>
        
        
    </resultMap>


	<resultMap id="RM.InventoryBatch.ListBycode" class="com.terrence.crm.dol.bean.InventoryBatch">
	        <result property="batchno" column="batchno"/>
	        <result property="fqty" column="fqty"/>
	    </resultMap>

	<resultMap id="RM.InventoryBatch.BatchnoAndDbno" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="dbno" column="dbno"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="batchfqty"/>
        <result property="fqtylock" column="fqtylock"/>
    </resultMap>

<resultMap id="RM.InventoryBatch.includePositionNew" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
        <result property="baseItem" resultMap="RM.InventoryBatch.BaseItem2"/>
		<result property="baseitemid" column="baseitemid"/>
        <result property="positionslist" column="baseitemid" select="InventoryBatch.finditemPostionlist"/>
		 
    </resultMap>
    
    
    <resultMap id="RM.InventoryBatch.includePositionNew.ad.cycle" class="com.terrence.crm.dol.bean.InventoryBatch"><!-- 添加cycle -->
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
        <result property="baseItem" resultMap="RM.InventoryBatch.BaseItem2"/>
        <result property="processCycle" resultMap="RM.ProcessCycle.in.inventoryBatch"/>
		<result property="baseitemid" column="baseitemid"/>
        <result property="positionslist" column="baseitemid" select="InventoryBatch.finditemPostionlist"/>
        
		<result property="deptid" column="deptid"/>
        <result property="invenlist" column="{itemcode=itemcode,deptid=deptid}" select="InventoryBatch.select.itemcode"/>
        
    </resultMap>
    <resultMap id="RM.InventoryBatch.includePositionNew.ad.cycle2" class="com.terrence.crm.dol.bean.InventoryBatch"><!-- 添加cycle -->
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="baseItem" resultMap="RM.InventoryBatch.BaseItem2.NewData"/>
        <result property="processCycle" resultMap="RM.ProcessCycle.in.inventoryBatch"/>
		<result property="baseitemid" column="baseitemid"/>
        <result property="positionslist" column="baseitemid" select="InventoryBatch.finditemPostionlist"/>
		<result property="deptid" column="deptid"/>
		
        <result property="invenlist" column="{itemcode=itemcode,deptid=deptid}" select="InventoryBatch.select.itemcode"/>
    </resultMap>
    
    <resultMap id="RM.ProcessCycle.in.inventoryBatch" class="com.terrence.crm.dol.bean.ProcessCycle">
        <result property="cyclename" column="cyclename"/>
    </resultMap>
    
    
    
     <resultMap id="RM.InventoryBatch.includePositionNew.cycle2.Export" class="com.terrence.crm.dol.bean.InventoryBatch"><!--数据导出 -->
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="baseItem" resultMap="RM.InventoryBatch.BaseItem2.NewData"/>
        <result property="processCycle" resultMap="RM.ProcessCycle.in.inventoryBatch"/>
		<result property="baseitemid" column="baseitemid"/>
        <result property="positionslist" column="baseitemid" select="InventoryBatch.finditemPostionlist"/>
		<result property="deptid" column="deptid"/>
		
        <result property="invenlist" column="{itemcode=itemcode,deptid=deptid,dbno=dbno}" select="InventoryBatch.select.itemcode.export.new"/>
    </resultMap>
	
	<resultMap id="RM.InventoryBatch.itemPostionlist" class="com.terrence.crm.dol.bean.Positions">
        <result property="positionid" column="positionid"/>
        <result property="parentid" column="parentid"/>
        <result property="positionname" column="positionname"/>
        <result property="type" column="type"/>
        <result property="levels" column="levels"/>
        <result property="number" column="number"/>
        <result property="allnumber" column="allnumber"/>
    </resultMap>


	<resultMap id="RM.InventoryBatch.fqtybatch" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqtyreal"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="stockname" column="stockname"/>
        <result property="dbno" column="dbno"/>
        <result property="fitemid" column="fitemid"/>
    </resultMap>

	<resultMap id="RM.InventoryBatch.k3difference" class="com.terrence.crm.dol.bean.InventoryBatch">
        
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="k3fqty" column="k3fqty"/>
        <result property="stockname" column="stockname"/>
        
		<result property="itemname" column="itemname"/>
		<result property="formatno" column="formatno"/>
		<result property="k5fqty" column="k5fqty"/>

    </resultMap>


	<resultMap id="RM.InventoryBatch.saledetail.findAllshuliang" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
        <result property="stockname" column="stockname"/>
        
        <result property="fissnmanager" column="fissnmanager"/>
        <result property="isbatch" column="isbatch"/>
    </resultMap>


<resultMap id="RM.InventoryBatch.findPage.AllDifferenceNew" class="com.terrence.crm.dol.bean.InventoryBatch" >
	
	<result property="fitemid" column="fitemid"/>
	<result property="itemcode" column="itemcode"/>
	<result property="itemname" column="itemname"/>
	<result property="itemmode" column="itemmode"/>
	<result property="pfqty" column="pfqty"/>
	<result property="k5fqty" column="k5fqty"/>
	<result property="k3fqty" column="k3fqty"/>
	<result property="stockname" column="stockname"/>
	<result property="batchno" column="batchno"/>
</resultMap>


<resultMap id="RM.InventoryBatch.getfqty.addicmo" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="itemcode" column="itemcode"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
		<result property="existdemand" column="itemcode" select="InventoryBatch.getfqty.addicmo.existdemand"/>
		     
    </resultMap>



	<resultMap id="RM.InventoryBatch.getforReturnOrder" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
    </resultMap>
    
	<resultMap id="RM.InventoryBatch.fro.FeiBatchiss" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="batchid" column="batchid"/>
        <result property="id" column="id"/>
        <result property="itemcode" column="itemcode"/>
        <result property="batchno" column="batchno"/>
        <result property="fqty" column="fqty"/>
        <result property="fqty2" column="fqty2"/>
        <result property="price" column="price"/>
        <result property="itemname" column="itemname"/>
        <result property="itemmode" column="itemmode"/>
        <result property="dbno" column="dbno"/>
        <result property="fqtylock" column="fqtylock"/>
        <result property="fitemid" column="fitemid"/>
        <result property="baseItem" resultMap="RM.InventoryBatch.BaseItem.Detail"/>
        <result property="stockname" column="stockname"/>
    </resultMap>




	<resultMap id="RM.InventoryBatch.getfqty.ByItemcode" class="com.terrence.crm.dol.bean.InventoryBatch">
        <result property="fqty" column="realfqty"/>
        <result property="dbno" column="dbno"/>
    </resultMap>





	<!-- 用于select查询公用抽取的列 -->
	<sql id="InventoryBatch.columns">
	    <![CDATA[
        	t_inventory_batch.batchid ,
        	t_inventory_batch.id ,
        	t_inventory_batch.itemcode ,
        	t_inventory_batch.batchno ,
        	t_inventory_batch.fqty ,
        	t_inventory_batch.fqty2 ,
        	t_inventory_batch.price ,
        	t_inventory_batch.itemname ,
        	t_inventory_batch.itemmode ,
        	t_inventory_batch.dbno ,
        	t_inventory_batch.fqtylock ,
        	t_inventory_batch.fitemid 
	    ]]>
	</sql>
	
   <insert id="InventoryBatch.insert" >
    
        INSERT INTO
        t_inventory_batch (
        
        	itemcode,
        	createdate
        <isNotEmpty prepend="," property="id">
        	id	
        </isNotEmpty>
        <isNotEmpty prepend="," property="batchno">
        	batchno
        </isNotEmpty>
        <isNotEmpty prepend="," property="fqty">
        	fqty
        </isNotEmpty>
        <isNotEmpty prepend="," property="fqty2">
        	fqty2
        </isNotEmpty>
        <isNotEmpty prepend="," property="price">
        	price
        </isNotEmpty>
        <isNotEmpty prepend="," property="itemname">
        	itemname
        </isNotEmpty>
        <isNotEmpty prepend="," property="itemmode">
        	itemmode
        </isNotEmpty>
        <isNotEmpty prepend="," property="dbno">
        	dbno
        </isNotEmpty>
        <isNotEmpty prepend="," property="fqtylock">
        	fqtylock
        </isNotEmpty>
        <isNotEmpty prepend="," property="fitemid">
        	fitemid
        </isNotEmpty>
        	 
        ) VALUES (
        	#itemcode#,
        	getdate()
        <isNotEmpty prepend="," property="id">
        	#id#	
        </isNotEmpty>
        <isNotEmpty prepend="," property="batchno">
        	#batchno#
        </isNotEmpty>
        <isNotEmpty prepend="," property="fqty">
        	#fqty#
        </isNotEmpty>
        <isNotEmpty prepend="," property="fqty2">
        	#fqty2#
        </isNotEmpty>
        <isNotEmpty prepend="," property="price">
        	#price#
        </isNotEmpty>
        <isNotEmpty prepend="," property="itemname">
        	#itemname#
        </isNotEmpty>
        <isNotEmpty prepend="," property="itemmode">
        	#itemmode#
        </isNotEmpty>
        <isNotEmpty prepend="," property="dbno">
        	#dbno#
        </isNotEmpty>
        <isNotEmpty prepend="," property="fqtylock">
        	#fqtylock#
        </isNotEmpty>
        <isNotEmpty prepend="," property="fitemid">
        	#fitemid#
        </isNotEmpty>
        	 
        )
    
    <!--
    mysql:		type="post" SELECT  select last_insert_id()
    sqlserver:	type="post" SELECT  @@identity  AS  ID
    oracle:		type="pre" 	SELECT  sequenceName.nextval AS ID FROM DUAL
    DB2:		type="pre"	values nextval for sequenceName
    -->
        <selectKey resultClass="java.lang.Long" type="post" keyProperty="batchid" >
            SELECT  @@identity  AS  ID
        </selectKey>
    </insert>
    
    
    
    
    <insert id="InventoryBatch.insert.in.putstorage" ><!-- 待入库审核后插入数据 -->
  
        INSERT INTO
        t_inventory_batch (
        	dbno
        	<isNotEmpty prepend="," property="id">
	        	id 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	itemcode
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="batchno">
	        	batchno
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty">
	        	fqty
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty2">
	        	fqty2
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="price">
	        	price
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	itemname
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemmode">
	        	itemmode
	        </isNotEmpty>
	        
	        <isNotEmpty prepend="," property="fqtylock">
	        	fqtylock
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fitemid">
	        	fitemid
	        </isNotEmpty>
        ) VALUES (
        	#dbno# 
        	 <isNotEmpty prepend="," property="id">
	        	#id# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	#itemcode# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="batchno">
	        	#batchno# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty">
	        	#fqty# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty2">
	        	#fqty2# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="price">
	        	#price# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	#itemname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemmode">
	        	#itemmode# 
	        </isNotEmpty>
	       
	        <isNotEmpty prepend="," property="fqtylock">
	        	 #fqtylock# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fitemid">
	        	#fitemid# 
	        </isNotEmpty>
        )
    <!--
    mysql:		type="post" SELECT  select last_insert_id()
    sqlserver:	type="post" SELECT  @@identity  AS  ID
    oracle:		type="pre" 	SELECT  sequenceName.nextval AS ID FROM DUAL
    DB2:		type="pre"	values nextval for sequenceName
    -->
        <selectKey resultClass="java.lang.Long" type="post" keyProperty="batchid" >
            SELECT  @@identity  AS  ID
        </selectKey>
    </insert>
    
    <insert id="InventoryBatch.insert.NewData.in.putstorage" ><!-- 非批次管理且数据库不存在该物料的保存数据 -->
  
        INSERT INTO
        t_inventory_batch (
        	dbno,batchno
        	<isNotEmpty prepend="," property="id">
	        	id 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	itemcode
	        </isNotEmpty>
	      
	        <isNotEmpty prepend="," property="fqty">
	        	fqty
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty2">
	        	fqty2
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="price">
	        	price
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	itemname
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemmode">
	        	itemmode
	        </isNotEmpty>
	        
	        <isNotEmpty prepend="," property="fqtylock">
	        	fqtylock
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fitemid">
	        	fitemid
	        </isNotEmpty>
        ) VALUES (
        	#dbno# ,''
        	 <isNotEmpty prepend="," property="id">
	        	#id# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	#itemcode# 
	        </isNotEmpty>
	       
	        <isNotEmpty prepend="," property="fqty">
	        	#fqty# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty2">
	        	#fqty2# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="price">
	        	#price# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	#itemname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemmode">
	        	#itemmode# 
	        </isNotEmpty>
	       
	        <isNotEmpty prepend="," property="fqtylock">
	        	 #fqtylock# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fitemid">
	        	#fitemid# 
	        </isNotEmpty>
        )
    <!--
    mysql:		type="post" SELECT  select last_insert_id()
    sqlserver:	type="post" SELECT  @@identity  AS  ID
    oracle:		type="pre" 	SELECT  sequenceName.nextval AS ID FROM DUAL
    DB2:		type="pre"	values nextval for sequenceName
    -->
        <selectKey resultClass="java.lang.Long" type="post" keyProperty="batchid" >
            SELECT  @@identity  AS  ID
        </selectKey>
    </insert>
    
    
    
    <update id="InventoryBatch.update.in.putstorage" parameterClass="com.terrence.crm.dol.bean.InventoryBatch"> <!-- 待入库非批次号管理的直接更新数据 -->        
        UPDATE t_inventory_batch 
        <dynamic prepend="SET">
	       
	        <isNotEmpty prepend="" property="fqty">
	        	fqty = #fqty# 
	        </isNotEmpty>
	          <isNotEmpty prepend="" property="fqty2">
	        	fqty2 = #fqty2# 
	        </isNotEmpty>
	       
	    </dynamic>
        WHERE 
	        itemcode = #itemcode# and batchno = ''
	        <isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
    </update>    
    
    
     <update id="InventoryBatch.update.fqtylock.data" parameterClass="com.terrence.crm.dol.bean.InventoryBatch"> <!-- 跟新锁库数量222222 -->        
        UPDATE t_inventory_batch 
        <dynamic prepend="SET">
	       
	        <isNotEmpty prepend="" property="fqty">
	        	fqtylock = fqtylock+#fqty# 
	        </isNotEmpty>
	          <isNotEmpty prepend="" property="fqty2">
	        	fqtylock = fqtylock+#fqty2# 
	        </isNotEmpty>
	       
	    </dynamic>
        WHERE 
	        itemcode = #itemcode#
	         <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
	        <isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
    </update>    
    
    <update id="InventoryBatch.update.in.putstorage.batch" parameterClass="com.terrence.crm.dol.bean.InventoryBatch"> <!-- 待入库同批次号，已存在的直接更新数据 -->        
        UPDATE t_inventory_batch 
        <dynamic prepend="SET">
	       
	        <isNotEmpty prepend="" property="fqty">
	        	fqty = #fqty# 
	        </isNotEmpty>
	          <isNotEmpty prepend="" property="fqty2">
	        	fqty2 = #fqty2# 
	        </isNotEmpty>
	       
	    </dynamic>
        WHERE 
	        itemcode = #itemcode# 
	        <isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
	        <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno= #batchno#
	       </isNotEmpty>
	       
    </update>    
    
       
    <update id="InventoryBatch.update.for.batchno.dataUpdate" parameterClass="com.terrence.crm.dol.bean.InventoryBatch"> <!-- 批次号的反审，更新数据 -->        
        UPDATE t_inventory_batch 
        <dynamic prepend="SET">
	       
	        <isNotEmpty prepend="" property="fqty">
	        	fqty = fqty-#fqty# 
	        </isNotEmpty>
	          <isNotEmpty prepend="" property="fqty2">
	        	fqty2 = fqty2-#fqty2# 
	        </isNotEmpty>
	       
	    </dynamic>
        WHERE 
	        itemcode = #itemcode# 
	        <isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
	        <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno= #batchno#
	       </isNotEmpty>
	       
    </update>    
    
    
     <update id="InventoryBatch.update.in.delete.salesDetailSum" parameterClass="com.terrence.crm.dol.bean.InventoryBatch"> <!-- 销售出库单删除，更新锁库数量 -->        
        UPDATE t_inventory_batch set
       			fqtylock = fqtylock-#fqtylock#
        WHERE 
	        itemcode = #itemcode# 
	        <isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
	        <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno= #batchno#
	       </isNotEmpty>
	       
    </update>    
    
  
    	<update id="InventoryBatch.update.data.for.void" parameterClass="com.terrence.crm.dol.bean.InventoryBatch">         
        UPDATE t_inventory_batch  set fqtylock = #fqtylock# 
        WHERE 
	        batchid = #batchid# 
    </update>
   

	<update id="InventoryBatch.update" parameterClass="com.terrence.crm.dol.bean.InventoryBatch">         
        UPDATE t_inventory_batch 
        <dynamic prepend="SET">
	        <isNotEmpty prepend="," property="id">
	        	id = #id# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	itemcode = #itemcode# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="batchno">
	        	batchno = #batchno# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty">
	        	fqty = #fqty# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty2">
	        	fqty2 = #fqty2# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="price">
	        	price = #price# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	itemname = #itemname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemmode">
	        	itemmode = #itemmode# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="dbno">
	        	dbno = #dbno# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqtylock">
	        	fqtylock = #fqtylock# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fitemid">
	        	fitemid = #fitemid# 
	        </isNotEmpty>
	    </dynamic>
        WHERE 
	        batchid = #batchid# 
    </update>
    <update id="InventoryBatch.update.fqty" parameterClass="com.terrence.crm.dol.bean.InventoryBatch">
    	UPDATE t_inventory_batch set fqty = #fqty# where batchno = #batchno# and dbno = #dbno# and batchno = #batchno#  and itemcode = #itemcode# 
    </update>
    <insert id="InventoryBatch.Insert.Sync">
	insert into t_inventory_batch (itemcode,fqty,batchno,dbno)
	select item.fnumber,sum(invent.fqty) fqty,fbatchno ,3
	from K33.AIS20120718093132.dbo.icinventory invent,K33.AIS20120718093132.dbo.t_icitem item where
	invent.fitemid=item.fitemid and not exists (select * from t_inventory_batch b where item.fnumber=b.itemcode and b.batchno=invent.fbatchno) 
 	group by invent.fitemid,item.fnumber,item.fname,item.fmodel,item.fsecinv,item.ferpclsid,fbatchno
	</insert>
	<update id="InventoryBatch.update.Sync">
	update t_inventory_batch set batchno=db3.fbatchno ,fqty=db3.fqty,itemname=fname,itemmode=fmodel from 
	(select item.fnumber,sum(invent.fqty) fqty,fbatchno ,3 db,item.fname,item.fmodel
	from K33.AIS20120718093132.dbo.icinventory invent,K33.AIS20120718093132.dbo.t_icitem item where
	invent.fitemid=item.fitemid 
	 group by invent.fitemid,item.fnumber,item.fname,item.fmodel,item.fsecinv,item.ferpclsid,fbatchno) db3
	 where dbno=3 and t_inventory_batch.itemcode=db3.fnumber and t_inventory_batch.batchno=db3.fbatchno
	</update>
	<insert id="InventoryBatch.Insert.Sync.004">
	insert into t_inventory_batch (itemcode,fqty,batchno,dbno)
	select item.fnumber,sum(invent.fqty) fqty,fbatchno ,4
	from K33.AIS20120912135429.dbo.icinventory invent,K33.AIS20120912135429.dbo.t_icitem item where
	invent.fitemid=item.fitemid and not exists (select * from t_inventory_batch b where item.fnumber=b.itemcode and b.batchno=invent.fbatchno)
 	group by invent.fitemid,item.fnumber,item.fname,item.fmodel,item.fsecinv,item.ferpclsid,fbatchno
	</insert>
	<update id="InventoryBatch.update.Sync.004">
	update t_inventory_batch set batchno=db4.fbatchno ,fqty=db4.fqty,itemname=fname,itemmode=fmodel  from 
	(select item.fnumber,sum(invent.fqty) fqty,fbatchno ,4 db,item.fname,item.fmodel
	from K33.AIS20120912135429.dbo.icinventory invent,K33.AIS20120912135429.dbo.t_icitem item where
	invent.fitemid=item.fitemid 
	 group by invent.fitemid,item.fnumber,item.fname,item.fmodel,item.fsecinv,item.ferpclsid,fbatchno) db4
	 where dbno=4 and t_inventory_batch.itemcode=db4.fnumber and t_inventory_batch.batchno=db4.fbatchno
	</update>
	
	<delete id="InventoryBatch.delete" parameterClass="java.lang.Long">
    <![CDATA[
        delete from t_inventory_batch where
       batchid = #batchid# 
    ]]>
    </delete>
    
    <delete id="InventoryBatch.deleteMultiple">
    <![CDATA[
        DELETE FROM 
        	t_inventory_batch 
        WHERE
       batchid in ($batchid$) 
    ]]>
    </delete>
    
     <delete id="InventoryBatch.delete.in.putsotrage"><!-- 待入库反审删除数据 -->
   
        DELETE FROM 
        	t_inventory_batch 
        WHERE
     	itemcode = #itemcode# and batchno = #batchno#
  		 <isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
    </delete>
    
    <select id="InventoryBatch.getById" resultMap="RM.InventoryBatch">
	    select <include refid="InventoryBatch.columns"/>
	    
	        from t_inventory_batch 
	        where 
		        batchid = #batchid# 
	    
    </select>
    <!-- 通过物料代码,批次号,仓库ID 查找 排产库存中某个物料的帐存数量 -->
    <select id="InventoryBatch.getByInfos" resultMap="RM.InventoryBatch">
	    select <include refid="InventoryBatch.columns"/>
	    
	        from t_inventory_batch 
	        where 
		       itemcode=#itemcode# and  batchno = #batchno#  and fitemid = #fitemid# and dbno=3
	    
    </select>
    
	<select id="InventoryBatch.getByProperty" resultMap="RM.InventoryBatch">
		select <include refid="InventoryBatch.columns"/> from t_inventory_batch where $propertyName$=#propertyValue#
	</select>
	
	<sql id="InventoryBatch.findPage.where">
	    <dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="batchid">
	             t_inventory_batch.batchid = #batchid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="id">
	             t_inventory_batch.id = #id#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemcode">
	            t_inventory_batch.itemcode like ('%$itemcode$%')
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="fnumber">
	            t_inventory_batch.itemcode = #fnumber#
	       </isNotEmpty>
	       <isNotNull  prepend="AND" property="batchno">
	       t_inventory_batch.batchno = #batchno#
	       </isNotNull>
			
	       
			<isNotEmpty prepend="AND" property="fqty">
	             t_inventory_batch.fqty = #fqty#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fqty2">
	             t_inventory_batch.fqty2 = #fqty2#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="price">
	             t_inventory_batch.price = #price#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemname">
	             t_inventory_batch.itemname like ('%$itemname$%')
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemmode">
	             t_inventory_batch.itemmode = #itemmode#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fqtylock">
	             t_inventory_batch.fqtylock = #fqtylock#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="expressionWhere">
	       		$expressionWhere$
	       </isNotEmpty>
	    </dynamic>	
	</sql>
	 
    <sql id="InventoryBatch.findPage.and">
			<isNotEmpty prepend="AND" property="batchid">
	             t_inventory_batch.batchid = #batchid#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="id">
	             t_inventory_batch.id = #id#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode like ('%$itemcode$%')
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="fnumber">
	            t_inventory_batch.itemcode = #fnumber#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="fqty">
	             t_inventory_batch.fqty = #fqty#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="fqty2">
	             t_inventory_batch.fqty2 = #fqty2#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="price">
	             t_inventory_batch.price = #price#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="itemname">
	             t_inventory_batch.itemname like ('%$itemname$%')
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="itemmode">
	             t_inventory_batch.itemmode = #itemmode#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="fqtylock">
	             t_inventory_batch.fqtylock = #fqtylock#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="expressionWhere">
	       		$expressionWhere$
	       </isNotEmpty>
	</sql>
	<select id="InventoryBatch.getByEntity" resultMap="RM.InventoryBatch">
		select <include refid="InventoryBatch.columns"/> from t_inventory_batch <include refid="InventoryBatch.findPage.where"/>
	</select>
    	<update id="InventoryBatch.update.Entity" parameterClass="com.terrence.crm.dol.bean.InventoryBatch">
		UPDATE t_inventory_batch 
		 <dynamic prepend="SET">
	        <isNotEmpty prepend="," property="id">
	        	id = #id# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	itemcode = #itemcode# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="batchno">
	        	batchno = #batchno# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty">
	        	fqty = #fqty# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty2">
	        	fqty2 = #fqty2# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="price">
	        	price = #price# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	itemname = #itemname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemmode">
	        	itemmode = #itemmode# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="dbno">
	        	dbno = #dbno# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqtylock">
	        	fqtylock = #fqtylock# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fitemid">
	        	fitemid = #fitemid# 
	        </isNotEmpty>
	    </dynamic>
	    <dynamic prepend="WHERE">
	    	<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	        	dbno = #dbno# 
	        </isNotEmpty>
	        <isNotEmpty prepend="AND" property="fitemid">
	        	fitemid = #fitemid# 
	        </isNotEmpty>
	     </dynamic>
	</update>
    <select id="InventoryBatch.findList" resultMap="RM.InventoryBatch.BaseItem">
    	SELECT t_inventory_batch.batchid ,t_inventory_batch.id ,t_inventory_batch.itemcode ,t_inventory_batch.batchno ,
        	t_inventory_batch.price ,t_inventory_batch.itemname ,t_inventory_batch.itemmode ,t_inventory_batch.dbno ,
        	t_inventory_batch.fqtylock ,t_inventory_batch.fitemid ,case dbno when 3 then fqty-fqtylock else fqty end fqty,
        	case dbno when 4 then fqty2-fqtylock else fqty2 end fqty2 ,t_base_item.isbatch,t_base_item.fissnmanager
    	FROM 
    		t_inventory_batch left join t_base_item  on t_inventory_batch.itemcode=t_base_item.itemcode 
		<include refid="InventoryBatch.findPage.where"/>
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    <select id="InventoryBatch.findList.unreview" resultMap="RM.InventoryBatch.BaseItem">
    	SELECT t_inventory_batch.batchid ,t_inventory_batch.id ,t_inventory_batch.itemcode ,t_inventory_batch.batchno ,
        	t_inventory_batch.price ,t_inventory_batch.itemname ,t_inventory_batch.itemmode ,t_inventory_batch.dbno ,
        	t_inventory_batch.fqtylock ,t_inventory_batch.fitemid 
        	,fqty,fqty2 ,
        	t_base_item.isbatch,t_base_item.fissnmanager
    	FROM 
    		t_inventory_batch left join t_base_item  on t_inventory_batch.itemcode=t_base_item.itemcode 
		<include refid="InventoryBatch.findPage.where"/>
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    
    
    <select id="InventoryBatch.findList2" resultMap="RM.InventoryBatch.BaseItem">
    	SELECT t_inventory_batch.batchid ,t_inventory_batch.id ,t_inventory_batch.itemcode ,t_inventory_batch.batchno ,
        	t_inventory_batch.price ,t_inventory_batch.itemname ,t_inventory_batch.itemmode ,t_inventory_batch.dbno ,
        	t_inventory_batch.fqtylock ,t_inventory_batch.fitemid ,fqty,fqty2 ,t_base_item.isbatch,t_base_item.fissnmanager
    	FROM 
    		t_inventory_batch left join t_base_item  on t_inventory_batch.itemcode=t_base_item.itemcode 
		<include refid="InventoryBatch.findPage.where"/>
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    <select id="InventoryBatch.findList.uninclude0" resultMap="RM.InventoryBatch.uninclude0">
    	SELECT 
    		case dbno when 3 then fqty when 4 then fqty2 end fqty,
    		 
				batchid,dbno,batchno,fqtylock,t_stock.fname stockname
    	FROM 
    		t_inventory_batch  left join t_stock on t_inventory_batch.fitemid=t_stock.fitemid
    	where 
	    	(case dbno when 3 then fqty when 4 then fqty2 end)-isnull(fqtylock,0)>0
		and itemcode=#itemcode#
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    
    <select id="InventoryBatch.findPage.count" resultClass="long">
    <![CDATA[
        select 
        count(*)
        from t_inventory_batch where fqty>0
    ]]>
		<include refid="InventoryBatch.findPage.and"/>    
    </select>
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
    -->
    <select id="Sql.InventoryBatch.findPage" resultMap="RM.InventoryBatch">
    	select <include refid="InventoryBatch.columns"/>	    
	        from t_inventory_batch 	   
		<include refid="InventoryBatch.findPage.where"/>		
		<isNotEmpty property="sortColumns">ORDER BY $sortColumns$</isNotEmpty>
		
    </select>
    
	<select id="InventoryBatch.findPage" resultMap="RM.InventoryBatch">
    	select <include refid="InventoryBatch.columns"/>	    
	        from t_inventory_batch where fqty>0
	   <isNotEmpty property="notTop">  and 
       batchid 
	   not in(select $notTop$ 
       batchid 
	   from t_inventory_batch where fqty>0 <include refid="InventoryBatch.findPage.and"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="InventoryBatch.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
	
		
    </select>
    
    
    
    <select id="InventoryBatch.findPage.Bydeptid.count" resultClass="long">
    <![CDATA[
        select 
        count(*)
        from t_inventory_batch,t_base_item where fqty>0 
    ]]>
    and t_inventory_batch.itemcode= t_base_item.itemcode 
	   and t_base_item.deptid =#deptid#
		<include refid="InventoryBatch.findPage.and"/>    
    </select>
    <!-- 库存查看,只查看当前班组库存 -->
    <select id="InventoryBatch.findPage.Bydeptid" resultMap="RM.InventoryBatch.includePosition"><!-- 添加查询项t_base_item.youtput,t_base_item.cycleid,t_base_item.itemproperty -->
    	select <include refid="InventoryBatch.columns"/>,t_positions.positionname,t_positions.positionid,t_base_item.makingnums
  		,t_base_item.existdemand,t_base_item.checkednum,t_base_item.youtput,t_base_item.cycleid,t_base_item.itemproperty	    
	        from t_inventory_batch,t_base_item
	        left join t_positions on
	        	 t_base_item.positionid
	        	 =t_positions.positionid 
	         where fqty>0 and 
	        t_inventory_batch.itemcode= t_base_item.itemcode and t_base_item.deptid =#deptid#
	        
	   <isNotEmpty property="notTop">  and 
       batchid 
	   not in(select $notTop$ 
       batchid 
	   from t_inventory_batch,t_base_item where fqty>0 and t_inventory_batch.itemcode= t_base_item.itemcode 
	   and t_base_item.deptid =#deptid#
	    <include refid="InventoryBatch.findPage.and"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="InventoryBatch.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    
    
    <select id="InventoryBatch.findPage.BydeptidP.count" resultClass="long">
    <![CDATA[
        select 
        count(*)
        from t_order_bom,t_inventory_batch,t_base_item where fqty>0 
    ]]>
    and t_order_bom.parentcode=t_inventory_batch.itemcode 
    and t_order_bom.itemcode=#pcode#
    and t_inventory_batch.itemcode= t_base_item.itemcode 
	and t_base_item.deptid =#deptid#
		<include refid="InventoryBatch.findPage.and"/>    
    </select>
    <!-- 库存查看,由上级代码查询 -->
    <select id="InventoryBatch.findPage.BydeptidP" resultMap="RM.InventoryBatch.includePosition"><!-- 添加查询项t_base_item.youtput,t_base_item.cycleid,t_base_item.itemproperty -->
    	select <include refid="InventoryBatch.columns"/>,t_positions.positionname,t_positions.positionid,t_base_item.makingnums
  		,t_base_item.existdemand,t_base_item.checkednum	,t_base_item.youtput,t_base_item.cycleid,t_base_item.itemproperty   
	        from t_order_bom,t_inventory_batch,t_base_item
	        left join t_positions on
	        	 t_base_item.positionid
	        	 =t_positions.positionid 
	         where fqty>0 and
	          t_order_bom.parentcode=t_inventory_batch.itemcode and
	          t_order_bom.itemcode=#pcode# and 
	        t_inventory_batch.itemcode= t_base_item.itemcode and t_base_item.deptid =#deptid#
	        
	   <isNotEmpty property="notTop">  and 
       batchid 
	   not in(select $notTop$ 
       batchid 
	   from t_order_bom,t_inventory_batch,t_base_item where fqty>0
	   and  t_order_bom.parentcode=t_inventory_batch.itemcode
	    and t_order_bom.itemcode=#pcode#
	    and t_inventory_batch.itemcode= t_base_item.itemcode 
	   and t_base_item.deptid =#deptid#
	    <include refid="InventoryBatch.findPage.and"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="InventoryBatch.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    
    
     
    <select id="InventoryBatch.findListBycode" resultMap="RM.InventoryBatch.ListBycode">
    
    	select t_inventory_batch.batchno ,case dbno when 3 then fqty when 4 then fqty2 end fqty
			from t_inventory_batch where itemcode=#itemcode# and (case dbno when 3 then fqty when 4 then fqty2 end)>0
     		
    </select>
    
	<select id="InventoryBatch.getBatchnoAndDbno" resultMap="RM.InventoryBatch.BatchnoAndDbno">
		select top 1 case dbno when 3 then fqty when 4 then fqty2 end batchfqty, 
		batchid,dbno,batchno,fqtylock
		from t_inventory_batch  where itemcode=#parentcode# 
		and (case dbno when 3 then fqty when 4 then fqty2 end)-isnull(fqtylock,0)>0
		order by batchno
    </select>    
	<procedure id="syncInventory" >
	{call pro_syncInventory()}
	</procedure>
	<!-- ====新版的多对多库存查看============================================= -->
	<!-- ====新版的多对多库存查看============================================= -->
	<select id="InventoryBatch.findPage.BydeptidNew.count" resultClass="long">
    <![CDATA[
        select 
        count(*)
        from   
    ]]>
     	(select 	
    			t_inventory_batch.itemcode ,
	        	t_inventory_batch.itemname ,
	        	t_inventory_batch.itemmode ,
	        	
		    	t_base_item.baseitemid,
		    	t_base_item.deptid,
		    	t_base_item.makingnums,
		    	t_base_item.existdemand,
		    	t_base_item.checkednum,
		    	t_base_item.youtput,
		    	t_base_item.cycleid,
		    	t_base_item.itemproperty,
		    	t_process_cycle.cyclename ,
		    	t_base_item.makingnums4,
		    	t_base_item.existdemand4,
		    	t_base_item.planfqty,
		    	t_base_item.planfqty4
	        from t_inventory_batch,t_base_item
	        
	        left join t_process_cycle on t_base_item.cycleid = t_process_cycle.cycleid
	        <isNotEmpty property="pcode">
	        ,t_order_bom
	        </isNotEmpty>
	         where 
	        	t_inventory_batch.itemcode= t_base_item.itemcode
	        	and (case dbno when 3 then fqty when 4 then fqty2 end)>0
	        	<isNotEmpty property="itemproperty">
		        and t_base_item.itemproperty=#itemproperty#
		        </isNotEmpty>	
		         <isNotEmpty property="fissnmanager">
	       			 and t_base_item.fissnmanager=#fissnmanager#
	       		 </isNotEmpty>
	        	<isNotEmpty property="deptid">	
		         and t_base_item.deptid =#deptid#
		         </isNotEmpty> 
	        	<isNotEmpty property="pcode">
		        and t_order_bom.parentcode=t_inventory_batch.itemcode 
	    		and t_order_bom.itemcode like '%$pcode$%'
		        </isNotEmpty>
		        <isNotEmpty property="fitemidlist">
	    		and   t_inventory_batch.fitemid in($fitemidlist$)
	        </isNotEmpty>
	         
	         
	   	<include refid="InventoryBatch.findPage.and"/>
	   	group by  
	   	t_inventory_batch.itemcode ,
	        	t_inventory_batch.itemname ,
	        	t_inventory_batch.itemmode ,
	        	
		    	t_base_item.baseitemid,
		    	t_base_item.deptid,
		    	t_base_item.makingnums,
		    	t_base_item.existdemand,
		    	t_base_item.checkednum,
		    	t_base_item.youtput,
		    	t_base_item.cycleid,
		    	t_base_item.itemproperty,
		    	t_process_cycle.cyclename ,
		    	t_base_item.makingnums4,
		    	t_base_item.existdemand4,
		    	t_base_item.planfqty,
		    	t_base_item.planfqty4
    	) c
    </select>
    <!-- 库存查看,只查看当前班组库存 -->
    <select id="InventoryBatch.findPage.BydeptidNew" resultMap="RM.InventoryBatch.includePositionNew.ad.cycle2"><!--999999999 添加查询项t_base_item.youtput,t_base_item.cycleid,t_base_item.itemproperty -->
    	select 	
    			t_inventory_batch.itemcode ,
	        	t_inventory_batch.itemname ,
	        	t_inventory_batch.itemmode ,
		    	t_base_item.baseitemid,
		    	t_base_item.deptid,
		    	t_base_item.makingnums,
		    	t_base_item.existdemand,
		    	t_base_item.checkednum,
		    	t_base_item.youtput,
		    	t_base_item.cycleid,
		    	t_base_item.itemproperty,t_base_item.fissnmanager,
		    	t_process_cycle.cyclename ,
		    	t_base_item.makingnums4,
		    	t_base_item.existdemand4,
		    	t_base_item.planfqty,
		    	t_base_item.planfqty4
	        from t_inventory_batch,t_base_item
	        
	        left join t_process_cycle on t_base_item.cycleid = t_process_cycle.cycleid
	        <isNotEmpty property="pcode">
	        ,t_order_bom
	        </isNotEmpty>
	         where 
	        	t_inventory_batch.itemcode= t_base_item.itemcode
	        	and (case dbno when 3 then fqty when 4 then fqty2 end)>0 
	        	
	        <isNotEmpty property="itemproperty">
	        and t_base_item.itemproperty=#itemproperty#
	        </isNotEmpty>	
	        <isNotEmpty property="deptid">	
	         and t_base_item.deptid =#deptid#
	         </isNotEmpty>
	          <isNotEmpty property="fissnmanager">
	        and t_base_item.fissnmanager=#fissnmanager#
	        </isNotEmpty>
	        <isNotEmpty property="pcode">
	        and t_order_bom.parentcode=t_inventory_batch.itemcode 
    		and t_order_bom.itemcode like '%$pcode$%'
	        </isNotEmpty>
	        <isNotEmpty property="fitemidlist">
	       and  t_inventory_batch.fitemid in($fitemidlist$)
	        </isNotEmpty>
	        
	   <isNotEmpty property="notTop">  and 
       t_inventory_batch.itemcode 
	   not in(select $notTop$ 
       t_inventory_batch.itemcode 
	   from t_inventory_batch,t_base_item  left join t_process_cycle on t_base_item.cycleid = t_process_cycle.cycleid
	   <isNotEmpty property="pcode">
	        ,t_order_bom
	        </isNotEmpty> 
	   where 
	   
	    t_inventory_batch.itemcode= t_base_item.itemcode 
	    and (case dbno when 3 then fqty when 4 then fqty2 end)>0
	    <isNotEmpty property="itemproperty">
	        and t_base_item.itemproperty=#itemproperty#
	        </isNotEmpty>	
	   <isNotEmpty property="deptid">	
	         and t_base_item.deptid =#deptid#
	         </isNotEmpty>
	   <isNotEmpty property="fitemidlist">
	       and  t_inventory_batch.fitemid in($fitemidlist$)
	        </isNotEmpty>
	   <isNotEmpty property="pcode">
	        and t_order_bom.parentcode=t_inventory_batch.itemcode 
    		and t_order_bom.itemcode like '%$pcode$%'
	    </isNotEmpty>
	    <isNotEmpty property="fissnmanager">
	        and t_base_item.fissnmanager=#fissnmanager#
	        </isNotEmpty>	
	    <include refid="InventoryBatch.findPage.and"/>
	    group by t_inventory_batch.itemcode
	   	    
                <isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
            )     
                
	   	</isNotEmpty>    
	   	<include refid="InventoryBatch.findPage.and"/>
	   	group by  
	   	t_inventory_batch.itemcode ,
	        	t_inventory_batch.itemname ,
	        	t_inventory_batch.itemmode ,
	        	
		    	t_base_item.baseitemid,
		    	t_base_item.deptid,
		    	t_base_item.makingnums,
		    	t_base_item.existdemand,
		    	t_base_item.checkednum,
		    	t_base_item.youtput,
		    	t_base_item.cycleid,
		    	t_base_item.itemproperty,t_base_item.fissnmanager,
		    	t_process_cycle.cyclename ,
		    	t_base_item.makingnums4,
		    	t_base_item.existdemand4,
		    	t_base_item.planfqty,
		    	t_base_item.planfqty4
    	
                <isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
	
		
	<select id="InventoryBatch.finditemPostionlist" resultMap="RM.InventoryBatch.itemPostionlist">
		select 
			t_positions.positionid ,
        	t_positions.parentid ,
        	t_positions.positionname ,
        	t_positions.type ,
        	t_positions.levels,
        	t_positions.number, 
			t_positions.allnumber
		from 
			t_item_postion
			left join t_positions on t_item_postion.positionid=t_positions.positionid
			
		 where t_item_postion.baseitemid=#baseitemid#  
	</select>
	
	<!-- =物料仓位多对多的库存查看,存在上级代码的查询===================== -->
	
    <select id="InventoryBatch.findPage.BydeptidPNew.count" resultClass="long">
    <![CDATA[
        select 
        count(*)
        from t_order_bom,t_inventory_batch,t_base_item where fqty>0 
    ]]>
    and t_order_bom.parentcode=t_inventory_batch.itemcode 
    and t_order_bom.itemcode=#pcode#
    and t_inventory_batch.itemcode= t_base_item.itemcode 
	and t_base_item.deptid =#deptid#
		<include refid="InventoryBatch.findPage.and"/>    
    </select>
    <!-- 库存查看,由上级代码查询 -->
    <select id="InventoryBatch.findPage.BydeptidPNew" resultMap="RM.InventoryBatch.includePositionNew"><!-- 添加查询项t_base_item.youtput,t_base_item.cycleid,t_base_item.itemproperty -->
    	select <include refid="InventoryBatch.columns"/>,
    	t_base_item.baseitemid,
    	t_base_item.makingnums,t_base_item.existdemand,t_base_item.checkednum,t_base_item.youtput,t_base_item.cycleid,t_base_item.itemproperty    
	        from t_order_bom,t_inventory_batch,t_base_item
	        
	         where fqty>0 and
	          t_order_bom.parentcode=t_inventory_batch.itemcode and
	          t_order_bom.itemcode=#pcode# and 
	        	t_inventory_batch.itemcode= t_base_item.itemcode 
	        and t_base_item.deptid =#deptid#
	   <isNotEmpty property="notTop">  and 
       batchid 
	   not in(select $notTop$ 
       batchid 
	   from t_order_bom,t_inventory_batch,t_base_item where fqty>0
	   and  t_order_bom.parentcode=t_inventory_batch.itemcode
	    and t_order_bom.itemcode=#pcode#
	    and t_inventory_batch.itemcode= t_base_item.itemcode 
	   and t_base_item.deptid =#deptid#
	    <include refid="InventoryBatch.findPage.and"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="InventoryBatch.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
	
	 <select id="InventoryBatch.find.IBentity" resultMap="RM.InventoryBatch"><!-- 查询为此itemcode的数据  -->
	    select <include refid="InventoryBatch.columns"/>
	    
	        from t_inventory_batch 
	        where 
		       1=1
		       <isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
    </select>
	
	 <select id="InventoryBatch.find.inba" resultMap="RM.InventoryBatch"><!-- 查询为此itemcode的数据  -->
	    select <include refid="InventoryBatch.columns"/>
	    
	        from t_inventory_batch 
	        where 
		       itemcode = #itemcode# 
	    
    </select>
	
	
	 <select id="InventoryBatch.select.itemcode" resultMap="RM.InventoryBatch.fqtybatch"><!-- 查询itemcode 相同的 -->
	     select (case t_inventory_batch.dbno when 3 then fqty when 4 then fqty2 end) fqtyreal 
	     ,t_inventory_batch.batchno ,t_inventory_batch.fqtylock ,t_stock.fname stockname ,t_inventory_batch.dbno,t_inventory_batch.fitemid 
	        from t_inventory_batch left join t_stock on t_inventory_batch.fitemid=t_stock.fitemid 
	        ,t_base_item
	        where 
	        t_inventory_batch.itemcode= t_base_item.itemcode 
	        and (case dbno when 3 then fqty when 4 then fqty2 end)>0
		       <isNotEmpty property="itemcode">
			    and t_inventory_batch.itemcode = #itemcode#
		       </isNotEmpty>
		        <isNotEmpty property="deptid">
			       and t_base_item.deptid =#deptid#		        
		        </isNotEmpty> 
		       
    </select>
    
    	 <select id="InventoryBatch.select.itemcode.export.new" resultMap="RM.InventoryBatch.fqtybatch"><!-- 导出数据 -->
	     select (case t_inventory_batch.dbno when 3 then fqty when 4 then fqty2 end) fqtyreal 
	     ,t_inventory_batch.batchno ,t_inventory_batch.fqtylock ,t_stock.fname stockname ,t_inventory_batch.dbno,t_inventory_batch.fitemid 
	        from t_inventory_batch left join t_stock on t_inventory_batch.fitemid=t_stock.fitemid 
	        ,t_base_item
	        where 
	        t_inventory_batch.itemcode= t_base_item.itemcode 
	        and (case dbno when 3 then fqty when 4 then fqty2 end)>0
		       <isNotEmpty property="itemcode">
			    and t_inventory_batch.itemcode = #itemcode#
		       </isNotEmpty>
		        <isNotEmpty property="deptid">
			       and t_base_item.deptid =#deptid#		        
		        </isNotEmpty> 
		        <isNotEmpty property="dbno">
			       and t_inventory_batch.dbno =#dbno#		        
		        </isNotEmpty> 
		       
    </select>
		
	
	<update id="InventoryBatch.updatefqty.3" parameterClass="com.terrence.crm.dol.bean.InventoryBatch">
		update t_inventory_batch set fqty=fqty+#fqty#,fqtylock=fqtylock+#fqty# where batchid=#batchid# 
	</update>
	
	<update id="InventoryBatch.updatefqty.4" parameterClass="com.terrence.crm.dol.bean.InventoryBatch">
		update t_inventory_batch set fqty2=fqty2+#fqty#,fqtylock=fqtylock+#fqty# where batchid=#batchid#
	</update>	

	
	<select id="InventoryBatch.k3difference.list" resultMap="RM.InventoryBatch.k3difference">
			select  
				c.itemcode itemcode,
				c.itemname itemname, 
				c.formatno formatno, 
				c.fqty fqty,
				t_k3ICInventory.fqty  k3fqty	,
				t_k3ICInventory.fbatchno batchno	,
				t_stock.fname stockname ,
				t_k5ICInventory.fqty  k5fqty	
				
			from t_k3ICInventory left join t_stock on t_stock.fitemid=t_k3ICInventory.fstockid
			,(
			   select a.itemcode,b.itemname,b.formatno,a.batchno,a.fqty,a.fitemid stockid,b.fitemid  from t_inventory_batch a left join t_base_item b 
			on a.itemcode=b.itemcode where a.dbno=3
			) c ,t_k5ICInventory
			where 
				t_k3ICInventory.fitemid=c.fitemid 
				and t_k3ICInventory.fbatchno=c.batchno 
				and t_k3ICInventory.fstockid=c.stockid
				and (c.fqty!=t_k3ICInventory.fqty or c.fqty!=t_k5ICInventory.fqty or t_k5ICInventory.fqty!=t_k3ICInventory.fqty)
				
				and t_k3ICInventory.fitemid=t_k5ICInventory.fitemid 
				and t_k3ICInventory.fbatchno=t_k5ICInventory.fbatchno 
				and t_k3ICInventory.fstockid=t_k5ICInventory.fstockid
			
			<isNotEmpty property="itemcode" prepend="AND">
				c.itemcode like ('%$itemcode$%')
			</isNotEmpty>
			<isNotEmpty property="fitemid" prepend="AND">
				c.stockid=#fitemid#
			</isNotEmpty>
			
</select>
	
	<select id="InventoryBatch.k5.paichan.difference.list" resultMap="RM.InventoryBatch.k3difference">
			select  
				c.itemcode itemcode,
				c.itemname itemname, 
				c.formatno formatno, 
				c.fqty fqty,
				0 k3fqty,
				c.batchno batchno,
				t_stock.fname stockname ,
				t_k5ICInventory.fqty  k5fqty	
			from 
			( select a.itemcode,b.itemname,b.formatno,a.batchno,a.fqty,a.fitemid stockid,b.fitemid  from t_inventory_batch a left join t_base_item b 
			on a.itemcode=b.itemcode where a.dbno=3
			) c
			 left join t_stock on t_stock.fitemid=c.stockid
			 ,t_k5ICInventory
			where 
				 c.fqty!=t_k5ICInventory.fqty 
				and c.fitemid=t_k5ICInventory.fitemid 
				and c.batchno=t_k5ICInventory.fbatchno 
				and c.stockid=t_k5ICInventory.fstockid
			<isNotEmpty property="itemcode" prepend="AND">
				c.itemcode like ('%$itemcode$%')
			</isNotEmpty>
			<isNotEmpty property="fitemid" prepend="AND">
				c.stockid=#fitemid#
			</isNotEmpty>
</select>	
<select id="InventoryBatch.k3.paichan.difference.list" resultMap="RM.InventoryBatch.k3difference">
			select  
				c.itemcode itemcode,
				c.itemname itemname, 
				c.formatno formatno, 
				c.fqty fqty,
				t_k3ICInventory.fqty k3fqty,
				c.batchno batchno,
				t_stock.fname stockname ,
				0  k5fqty	
			from 
			( select a.itemcode,b.itemname,b.formatno,a.batchno,a.fqty,a.fitemid stockid,b.fitemid  from t_inventory_batch a left join t_base_item b 
			on a.itemcode=b.itemcode where a.dbno=3
			) c
			 left join t_stock on t_stock.fitemid=c.stockid
			 ,t_k3ICInventory
			where 
				 c.fqty!=t_k3ICInventory.fqty 
				and c.fitemid=t_k3ICInventory.fitemid 
				and c.batchno=t_k3ICInventory.fbatchno 
				and c.stockid=t_k3ICInventory.fstockid
			<isNotEmpty property="itemcode" prepend="AND">
				c.itemcode like ('%$itemcode$%')
			</isNotEmpty>
			<isNotEmpty property="fitemid" prepend="AND">
				c.stockid=#fitemid#
			</isNotEmpty>
</select>	
	
	
	

 <select id="InventoryBatch.find.List.inventBatch" resultMap="RM.InventoryBatch"><!-- 查询为此itemcode的数据  -->
	    select <include refid="InventoryBatch.columns"/>
	        from t_inventory_batch 
	        where 
		       itemcode = #itemcode# and batchno like ('%$batchno$%')
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
    </select>
	
  <select id="InventoryBatch.getBydb.codebatchnofitemid" resultMap="RM.InventoryBatch">
	    select <include refid="InventoryBatch.columns"/>
	    
	        from t_inventory_batch
	        where 
		        1=1 
		       
		    <isNotEmpty prepend="AND" property="itemcode">
	        	itemcode = #itemcode# 
	        </isNotEmpty> 
		    <isNotEmpty prepend="AND" property="batchno">
	        	batchno = #batchno# 
	        </isNotEmpty>
		    <isNotEmpty prepend="AND" property="fitemid">
	        	fitemid = #fitemid# 
	        </isNotEmpty>
		    <isNotEmpty prepend="AND" property="dbno">
	        	dbno = #dbno# 
	        </isNotEmpty>
		         
    </select>
    
	<procedure id="InventoryBatch.updatek3k5.icinventory" >
		{call pro_getk3k5inventory()}
	</procedure>
	<statement id="InventoryBatch.updatek3k5.icinventoryALl">
		BEGIN
			drop table t_k3ICInventory ;
			drop table t_k5ICInventory ;
			
		select k3item.fnumber itemcode,k3item.fmodel formatno,k3item.fname itemname, k3item.fitemid,fstockid,fqty into t_k3ICInventory 
			from K33.AIS20120718093132.dbo.ICInventory k3inventory
			left join K33.AIS20120718093132.dbo.t_icitem k3item on k3inventory.fitemid=k3item.fitemid;			
					
		select k5item.fnumber itemcode,k5item.fmodel formatno,k5item.fname itemname, k5item.fitemid,fstockid,fqty into t_k5ICInventory 
			from K33.AIS20120813194456.dbo.ICInventory k5inventory
			left join K33.AIS20120813194456.dbo.t_icitem k5item on k5inventory.fitemid=k5item.fitemid ;	

		END;
	</statement>
 <select id="InventoryBatch.find.entity.for.batchno" resultMap="RM.InventoryBatch"><!-- 查询为此itemcode的数据  -->
	    select <include refid="InventoryBatch.columns"/>
	    
	        from t_inventory_batch 
	        where 
		       1=1 and batchno =''
		       <isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
    </select>

	<select id="InventoryBatch.getByEntity.real" resultMap="RM.InventoryBatch">
		select <include refid="InventoryBatch.columns"/> from t_inventory_batch 
		where 1=1
		<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
		   <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
		
		
		
	</select>
	
	<select id="InventoryBatch.getByEntity.real.NEW" resultMap="RM.InventoryBatch">
		select <include refid="InventoryBatch.columns"/> from t_inventory_batch 
		where 1=1 and  t_inventory_batch.batchno = #batchno#
		<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
		
	</select>

<select id="InventoryBatch.getByDetail" resultMap="RM.InventoryBatch.getByDetail"><!-- w删除出库单时查询库存,修改锁库数量 -->
		select  
			t_inventory_batch.batchid ,t_inventory_batch.fqtylock,
			(case dbno when 3 then fqty when 4 then fqty2 end) fqty
			
			from t_inventory_batch
			where 1=1
			<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
		   <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
</select>


<select id="InventoryBatch.find.in.salesDetailSum" resultMap="RM.InventoryBatch"><!-- 添加销售出库时，查询批次号 -->
	    select <include refid="InventoryBatch.columns"/>
	        from t_inventory_batch 
		   where 1=1 and (fqty>0 or fqty2>0)
			<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
	         <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
    </select>
    
    
    
    <select id="InventoryBatch.find.findAllShuLiang" resultMap="RM.InventoryBatch.saledetail.findAllshuliang"><!-- 销售出库单，查总库存 -->
	    select <include refid="InventoryBatch.columns"/>,t_stock.fname stockname,t_base_item.fissnmanager fissnmanager,t_base_item.isbatch isbatch
	        from t_inventory_batch 
	        left join t_stock on t_inventory_batch.fitemid = t_stock.fitemid
	        left join t_base_item on t_inventory_batch.itemcode = t_base_item.itemcode
		   where 1=1 and (fqty>0 or fqty2>0)
			<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
	        
    </select>





<!-- 新版k3总库存差异查询2014-06-03  以3帐套为基表的查询 -->
<!-- 
<select id="InventoryBatch.findPage.k3AllDifferenceNew" resultMap="RM.InventoryBatch.findPage.AllDifferenceNew">
		select 
				k3.fitemid,
				k3.itemcode,
				k3.itemname,
				k3.formatno itemmode,
				p.pfqty pfqty,
				k5.fqty k5fqty,
				k3.fqty k3fqty,
				k3.stockname,
				k3.fbatchno batchno
			from 
			(
			select 
			t_base_item.itemcode,t_base_item.itemname,t_base_item.formatno, t_k3icinventory.fitemid,t_k3icinventory.fstockid,t_stock.fname stockname,t_k3icinventory.fqty,t_k3icinventory.fbatchno 
			from t_k3icinventory
			 	left join t_base_item on t_k3icinventory.fitemid=t_base_item.fitemid
				left join t_stock on  t_k3icinventory.fstockid=t_stock.fitemid
			) k3
			left join ( 
			select fitemid,fstockid,fqty,fbatchno from t_k5icinventory 
			) k5 on k3.fitemid=k5.fitemid and k3.fstockid=k5.fstockid and k3.fbatchno=k5.fbatchno
			left join ( 
			select itemcode,fitemid fstockid,fqty pfqty,batchno from  t_inventory_batch where dbno=3 
			) p on k3.itemcode=p.itemcode and k3.fstockid=p.fstockid and k3.fbatchno=p.batchno
		where 
		1=1 
		and (k3.fqty!=isnull(k5.fqty,0) or k3.fqty!=isnull(p.pfqty,0) or isnull(k5.fqty,0)!=isnull(p.pfqty,0))
		
		<isNotEmpty prepend="AND" property="itemcode">
	             k3.itemcode like '%$itemcode$%'
	     </isNotEmpty>
		<isNotEmpty prepend="AND" property="fitemid">
	             k3.fstockid = #fitemid#
	     </isNotEmpty>
		
</select>	-->
	<select id="InventoryBatch.findPage.k3AllDifferenceNew" resultMap="RM.InventoryBatch.findPage.AllDifferenceNew">
		select 
				k3.fitemid,
				k3.itemcode,
				k3.itemname,
				k3.formatno itemmode,
				p.pfqty pfqty,
				k5.fqty k5fqty,
				k3.fqty k3fqty,
				k3.stockname,
				'0' batchno
			from 
			(
			select 
			t_k3icinventory.itemcode,t_k3icinventory.itemname,t_k3icinventory.formatno, t_k3icinventory.fitemid
			,t_k3icinventory.fstockid,t_stock.fname stockname,sum(t_k3icinventory.fqty) fqty 
			from t_k3icinventory
				left join t_stock on  t_k3icinventory.fstockid=t_stock.fitemid
				group by t_k3icinventory.itemcode,t_k3icinventory.itemname,t_k3icinventory.formatno, t_k3icinventory.fitemid
			,t_k3icinventory.fstockid,t_stock.fname
			) k3
			left join ( 
			select itemcode,fstockid,sum(fqty) fqty  from t_k5icinventory group by  itemcode,fstockid
			) k5 on k3.itemcode=k5.itemcode and k3.fstockid=k5.fstockid 
			left join ( 
			select itemcode,fitemid fstockid,sum(fqty) pfqty from  t_inventory_batch where dbno=3 group by  itemcode,fitemid
			) p on k3.itemcode=p.itemcode and k3.fstockid=p.fstockid 
		where 
		1=1 
		and (k3.fqty!=isnull(k5.fqty,0) or k3.fqty!=isnull(p.pfqty,0) or isnull(k5.fqty,0)!=isnull(p.pfqty,0))
		
		<isNotEmpty prepend="AND" property="itemcode">
	             k3.itemcode like '%$itemcode$%'
	     </isNotEmpty>
		<isNotEmpty prepend="AND" property="fitemid">
	             k3.fstockid = #fitemid#
	     </isNotEmpty>
		
</select>
	
	
	
<!-- 以5帐套为基表的查询 -->	
<!-- <select id="InventoryBatch.findPage.k5AllDifferenceNew" resultMap="RM.InventoryBatch.findPage.AllDifferenceNew">
		select 
				k5.fitemid,
				k5.itemcode,
				k5.itemname,
				k5.formatno itemmode,
				p.pfqty pfqty,
				k5.fqty k5fqty,
				k3.fqty k3fqty,
				k5.stockname,
				k5.fbatchno batchno
			from 
			(
			select 
			t_base_item.itemcode,t_base_item.itemname,t_base_item.formatno, t_k5icinventory.fitemid,t_k5icinventory.fstockid,t_stock.fname stockname,t_k5icinventory.fqty,t_k5icinventory.fbatchno 
			from t_k5icinventory
			 	left join t_base_item on t_k5icinventory.fitemid=t_base_item.fitemid
				left join t_stock on  t_k5icinventory.fstockid=t_stock.fitemid
			) k5
			left join ( 
			select fitemid,fstockid,fqty,fbatchno from t_k3icinventory 
			) k3 on k5.fitemid=k3.fitemid and k5.fstockid=k3.fstockid and k5.fbatchno=k3.fbatchno
			left join ( 
			select itemcode,fitemid fstockid,fqty pfqty,batchno from  t_inventory_batch where dbno=3 
			) p on k5.itemcode=p.itemcode and k5.fstockid=p.fstockid and k5.fbatchno=p.batchno
		where 
		1=1
		and (k5.fqty!=isnull(k3.fqty,0) or k5.fqty!=isnull(p.pfqty,0) or isnull(k3.fqty,0)!=isnull(p.pfqty,0))
		
		<isNotEmpty prepend="AND" property="itemcode">
	             k5.itemcode like '%$itemcode$%'
	     </isNotEmpty>
		<isNotEmpty prepend="AND" property="fitemid">
	             k5.fstockid = #fitemid#
	     </isNotEmpty>
		
</select>	
	 -->
<select id="InventoryBatch.findPage.k5AllDifferenceNew" resultMap="RM.InventoryBatch.findPage.AllDifferenceNew">
		select 
				k5.fitemid,
				k5.itemcode,
				k5.itemname,
				k5.formatno itemmode,
				p.pfqty pfqty,
				k5.fqty k5fqty,
				k3.fqty k3fqty,
				k5.stockname,
				'0' batchno
			from 
			(
			select 
			t_k5icinventory.itemcode,t_k5icinventory.itemname,t_k5icinventory.formatno, t_k5icinventory.fitemid
			,t_k5icinventory.fstockid,t_stock.fname stockname,sum(t_k5icinventory.fqty) fqty 
			from t_k5icinventory
				left join t_stock on  t_k5icinventory.fstockid=t_stock.fitemid
				group by t_k5icinventory.itemcode,t_k5icinventory.itemname,t_k5icinventory.formatno, t_k5icinventory.fitemid
			,t_k5icinventory.fstockid,t_stock.fname 
			) k5
			left join ( 
			select itemcode,fstockid,sum(fqty) fqty from t_k3icinventory group by itemcode,fstockid  
			) k3 on k5.itemcode=k3.itemcode and k5.fstockid=k3.fstockid
			left join ( 
			select itemcode,fitemid fstockid,sum(fqty) pfqty from  t_inventory_batch where dbno=3 group by itemcode,fitemid   
			) p on k5.itemcode=p.itemcode and k5.fstockid=p.fstockid 
		where 
		1=1
		and (k5.fqty!=isnull(k3.fqty,0) or k5.fqty!=isnull(p.pfqty,0) or isnull(k3.fqty,0)!=isnull(p.pfqty,0))
		
		<isNotEmpty prepend="AND" property="itemcode">
	             k5.itemcode like '%$itemcode$%'
	     </isNotEmpty>
		<isNotEmpty prepend="AND" property="fitemid">
	             k5.fstockid = #fitemid#
	     </isNotEmpty>
		
</select>	
	
	
	
	
<!-- 以排产为基表的查询 -->	
<!-- 
<select id="InventoryBatch.findPage.paichanAllDifferenceNew" resultMap="RM.InventoryBatch.findPage.AllDifferenceNew">
		select 
				p.fitemid,
				p.itemcode,
				p.itemname,
				p.formatno itemmode,
				p.pfqty pfqty,
				k5.fqty k5fqty,
				k3.fqty k3fqty,
				p.stockname,
				p.batchno
			from
			( 
			select t_inventory_batch.itemcode,t_base_item.itemname,t_base_item.fitemid,t_base_item.formatno
			,t_inventory_batch.fitemid fstockid,t_inventory_batch.fqty pfqty,t_inventory_batch.batchno 
			,t_stock.fname stockname
			from  t_inventory_batch
			left join t_base_item on t_inventory_batch.itemcode=t_base_item.itemcode
			left join t_stock on  t_inventory_batch.fitemid=t_stock.fitemid
			 where t_inventory_batch.dbno=3 
			) p 
			left join(
			select fitemid,fstockid,fqty,fbatchno from t_k5icinventory 
			) k5 on p.fitemid=k5.fitemid and p.fstockid=k5.fstockid and p.batchno=k5.fbatchno
			left join ( 
			select fitemid,fstockid,fqty,fbatchno from t_k3icinventory 
			) k3 on p.fitemid=k3.fitemid and p.fstockid=k3.fstockid and p.batchno=k3.fbatchno
			
		where 
		1=1 
		and (p.pfqty!=isnull(k3.fqty,0) or p.pfqty!=isnull(k5.fqty,0) or isnull(k3.fqty,0)!=isnull(k5.fqty,0))
		
		<isNotEmpty prepend="AND" property="itemcode">
	             p.itemcode like '%$itemcode$%'
	     </isNotEmpty>
		<isNotEmpty prepend="AND" property="fitemid">
	             p.fstockid = #fitemid#
	     </isNotEmpty>
		
</select>		
	
	 -->
	
<select id="InventoryBatch.findPage.paichanAllDifferenceNew" resultMap="RM.InventoryBatch.findPage.AllDifferenceNew">
		select 
				p.fitemid,
				p.itemcode,
				p.itemname,
				p.formatno itemmode,
				p.pfqty pfqty,
				k5.fqty k5fqty,
				k3.fqty k3fqty,
				p.stockname,
				'0' batchno
			from
			( 
			select t_inventory_batch.itemcode,t_base_item.itemname,t_base_item.fitemid,t_base_item.formatno
			,t_inventory_batch.fitemid fstockid,sum(t_inventory_batch.fqty) pfqty 
			,t_stock.fname stockname
			from  t_inventory_batch
			left join t_base_item on t_inventory_batch.itemcode=t_base_item.itemcode
			left join t_stock on  t_inventory_batch.fitemid=t_stock.fitemid
			 where t_inventory_batch.dbno=3 
			 group by t_inventory_batch.itemcode,t_base_item.itemname,t_base_item.fitemid,t_base_item.formatno
			,t_inventory_batch.fitemid ,t_stock.fname 
			) p 
			left join(
			select itemcode,fstockid,sum(fqty) fqty from t_k5icinventory group by itemcode,fstockid
			) k5 on p.itemcode=k5.itemcode and p.fstockid=k5.fstockid 
			left join ( 
			select itemcode,fstockid,sum(fqty) fqty from t_k3icinventory group by itemcode,fstockid  
			) k3 on p.itemcode=k3.itemcode and p.fstockid=k3.fstockid 
			
		where 
		1=1 
		and (p.pfqty!=isnull(k3.fqty,0) or p.pfqty!=isnull(k5.fqty,0) or isnull(k3.fqty,0)!=isnull(k5.fqty,0))
		
		<isNotEmpty prepend="AND" property="itemcode">
	             p.itemcode like '%$itemcode$%'
	     </isNotEmpty>
		<isNotEmpty prepend="AND" property="fitemid">
	             p.fstockid = #fitemid#
	     </isNotEmpty>
		
</select>		
		
<select id="InventoryBatch.getByEntity.fqtycheck" resultMap="RM.InventoryBatch">
		select <include refid="InventoryBatch.columns"/> from t_inventory_batch 
		where 1=1
		<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
		   <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
		
		
		
	</select>	

	
<select id="InventoryBatch.find.data.in.void" resultMap="RM.InventoryBatch">
    	select <include refid="InventoryBatch.columns"/>	    
	        from t_inventory_batch 	   
		<include refid="InventoryBatch.findPage.where"/>
</select>	
	
	
	<select id="InventoryBatch.find.entity.returnGoods" resultMap="RM.InventoryBatch"><!-- 退货数据查询 -->
		select <include refid="InventoryBatch.columns"/> from t_inventory_batch 
		where 1=1
		<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	    	<isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
		   <isNotEmpty prepend="AND" property="batchno">
	             t_inventory_batch.batchno = #batchno#
	       </isNotEmpty>
	</select>	




	<select id="InventoryBatch.getfqty.addicmo" resultMap="RM.InventoryBatch.getfqty.addicmo">
		select 
		       sum(isnull(t_inventory_batch.fqty,0)) fqty,sum(isnull(t_inventory_batch.fqty2,0)) fqty2, t_inventory_batch.itemcode 
		from t_inventory_batch 
		where 1=1
			<isNotEmpty prepend="AND" property="itemcode">
	             t_inventory_batch.itemcode = #itemcode#
	      	 </isNotEmpty>
	group by t_inventory_batch.itemcode 	      	 
	</select>	


<select id="InventoryBatch.getfqty.addicmo.existdemand" resultClass="double">
		select 
		        isnull(existdemand,0) existdemand 
			from t_base_item 
			where 
            t_base_item.itemcode = #itemcode#
	</select>



	<select id="InventoryBatch.getforReturnOrder" resultMap="RM.InventoryBatch.getforReturnOrder">
		
		select <include refid="InventoryBatch.columns"/> 
			from t_inventory_batch 
			where 1=1 
			<isNotEmpty prepend="AND" property="itemcode">
		             t_inventory_batch.itemcode = #itemcode#
		      	 </isNotEmpty>
		    	<isNotEmpty prepend="AND" property="fitemid">
		             t_inventory_batch.fitemid = #fitemid#
		       </isNotEmpty>
		       <isNotEmpty prepend="AND" property="dbno">
		             t_inventory_batch.dbno = #dbno#
		       </isNotEmpty>
			   <isNotEmpty prepend="AND" property="batchno">
		             t_inventory_batch.batchno = #batchno#
		       </isNotEmpty>
		
	</select>



	<select id="InventoryBatch.InventoryExport.data" resultMap="RM.InventoryBatch.includePositionNew.cycle2.Export"><!--数据导出 -->
    	select  top	$top$ 
    			t_inventory_batch.itemcode ,
	        	t_inventory_batch.itemname ,
	        	t_inventory_batch.itemmode ,
	        	t_inventory_batch.dbno,
		    	t_base_item.baseitemid,
		    	t_base_item.deptid,
		    	t_base_item.makingnums,
		    	t_base_item.existdemand,
		    	t_base_item.checkednum,
		    	t_base_item.youtput,
		    	t_base_item.cycleid,
		    	t_base_item.itemproperty,t_base_item.fissnmanager,
		    	t_process_cycle.cyclename ,
		    	t_base_item.makingnums4,
		    	t_base_item.existdemand4,
		    	t_base_item.planfqty,
		    	t_base_item.planfqty4
	        from t_inventory_batch,t_base_item
	        
	        left join t_process_cycle on t_base_item.cycleid = t_process_cycle.cycleid
	        <isNotEmpty property="pcode">
	        ,t_order_bom
	        </isNotEmpty>
	         where 
	        	t_inventory_batch.itemcode= t_base_item.itemcode
	        	and (case dbno when 3 then fqty when 4 then fqty2 end)>0 
	        	
	        <isNotEmpty property="itemproperty">
	        and t_base_item.itemproperty=#itemproperty#
	        </isNotEmpty>	
	        <isNotEmpty property="deptid">	
	         and t_base_item.deptid =#deptid#
	         </isNotEmpty>
	          <isNotEmpty property="fissnmanager">
	        and t_base_item.fissnmanager=#fissnmanager#
	        </isNotEmpty>
	        <isNotEmpty property="pcode">
	        and t_order_bom.parentcode=t_inventory_batch.itemcode 
    		and t_order_bom.itemcode like '%$pcode$%'
	        </isNotEmpty>
	        <isNotEmpty property="fitemidlist">
	       and  t_inventory_batch.fitemid in($fitemidlist$)
	        </isNotEmpty>
	        
	     
	     
	     <isNotEmpty property="notTop">  and 
       t_inventory_batch.itemcode 
	   not in(select  top $notTop$ 
       t_inventory_batch.itemcode 
	   from t_inventory_batch,t_base_item  left join t_process_cycle on t_base_item.cycleid = t_process_cycle.cycleid
	   <isNotEmpty property="pcode">
	        ,t_order_bom
	        </isNotEmpty> 
	   where 
	   
	    t_inventory_batch.itemcode= t_base_item.itemcode 
	    and (case dbno when 3 then fqty when 4 then fqty2 end)>0
	    <isNotEmpty property="itemproperty">
	        and t_base_item.itemproperty=#itemproperty#
	        </isNotEmpty>	
	   <isNotEmpty property="deptid">	
	         and t_base_item.deptid =#deptid#
	         </isNotEmpty>
	   <isNotEmpty property="fitemidlist">
	       and  t_inventory_batch.fitemid in($fitemidlist$)
	        </isNotEmpty>
	   <isNotEmpty property="pcode">
	        and t_order_bom.parentcode=t_inventory_batch.itemcode 
    		and t_order_bom.itemcode like '%$pcode$%'
	    </isNotEmpty>
	    <isNotEmpty property="fissnmanager">
	        and t_base_item.fissnmanager=#fissnmanager#
	        </isNotEmpty>	
	    <include refid="InventoryBatch.findPage.and"/>
	    group by t_inventory_batch.itemcode
	   	    
                <isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
            )     
                
	   	</isNotEmpty> 
	   	
	   	<include refid="InventoryBatch.findPage.and"/>
	   	group by  
	   	t_inventory_batch.itemcode ,
	        	t_inventory_batch.itemname ,
	        	t_inventory_batch.itemmode ,
	        	
		    	t_base_item.baseitemid,
		    	t_base_item.deptid,
		    	t_base_item.makingnums,
		    	t_base_item.existdemand,
		    	t_base_item.checkednum,
		    	t_base_item.youtput,
		    	t_base_item.cycleid,
		    	t_base_item.itemproperty,t_base_item.fissnmanager,
		    	t_process_cycle.cyclename ,
    			t_inventory_batch.dbno,
    			t_base_item.makingnums4,
		    	t_base_item.existdemand4,
		    	t_base_item.planfqty,
		    	t_base_item.planfqty4
                <isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
	
	<select id="InventoryBatch.find.list.for.feiBatchIss" resultMap="RM.InventoryBatch.fro.FeiBatchiss"><!-- 123 -->
    	SELECT t_inventory_batch.batchid ,t_inventory_batch.id ,t_inventory_batch.itemcode ,t_inventory_batch.batchno ,
        	t_inventory_batch.price ,t_inventory_batch.itemname ,t_inventory_batch.itemmode ,t_inventory_batch.dbno ,
        	t_inventory_batch.fqtylock ,t_inventory_batch.fitemid ,case dbno when 3 then fqty-fqtylock else fqty end fqty,
        	case dbno when 4 then fqty2-fqtylock else fqty2 end fqty2 ,t_base_item.isbatch,t_base_item.fissnmanager,t_stock.fname  stockname
    	FROM 
    		t_inventory_batch left join t_base_item  on t_inventory_batch.itemcode=t_base_item.itemcode 
    		left join t_stock on t_inventory_batch.fitemid = t_stock.fitemid
		<include refid="InventoryBatch.findPage.where"/>
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    
    
    <select id="InventoryBatch.getfqty.ByItemcode" resultMap="RM.InventoryBatch.getfqty.ByItemcode">
 		select 
 			dbno,(case dbno when 3 then sum(fqty) when 4 then sum(fqty2) end) realfqty
 		
 		from t_inventory_batch 
 		where 
 		t_inventory_batch.itemcode=#itemcode# group by itemcode,dbno 	   	
    	
    </select>
    
    
    <select id="InventoryBatch.find.batch.fqtylock" resultMap="RM.InventoryBatch">
 		  	select  <include refid="InventoryBatch.columns"/>   
 		  	from t_inventory_batch where itemcode=#itemcode# and  dbno=#dbno# and fitemid = #fitemid#
			   <isNotEmpty prepend="AND" property="batchno">
		             t_inventory_batch.batchno = #batchno#
		       </isNotEmpty>   	
    </select>
    
     <update id="InventoryBatch.update.lockfqty.data" parameterClass="com.terrence.crm.dol.bean.InventoryBatch">       
        UPDATE t_inventory_batch set
        	fqtylock=fqtylock-#fqtylock#
        WHERE 
	        itemcode = #itemcode# 
	       and  t_inventory_batch.batchno= #batchno#
	        <isNotEmpty prepend="AND" property="fitemid">
	             t_inventory_batch.fitemid = #fitemid#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="dbno">
	             t_inventory_batch.dbno = #dbno#
	       </isNotEmpty>
	       
	       
    </update>    
    
    <select id="InventoryBatch.findlist.in.callslip" resultMap="RM.InventoryBatch.callslip">
 		  	select  <include refid="InventoryBatch.columns"/>,t_stock.fname stockname
 		  	from t_inventory_batch 
 		  	left join t_stock on t_inventory_batch.fitemid=t_stock.fitemid
 		  	where itemcode=#itemcode#	
    </select>
</sqlMap>


