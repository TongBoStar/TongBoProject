<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Icmo">

        
	<resultMap id="RM.Icmo" class="com.terrence.crm.dol.bean.Icmo">
        <result property="icmoid" column="icmoid"/>
        <result property="fbillno" column="fbillno"/>
        <result property="fitemid" column="fitemid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="plancommitdate" column="plancommitdate"/>
        <result property="planfinishdate" column="planfinishdate"/>
        <result property="status" column="status"/>
        <result property="fqty" column="fqty"/>
        <result property="dispathstatu" column="dispathstatu"/>
        <result property="tasktype" column="tasktype"/>
        <result property="performstatus" column="performstatus"/>
        <result property="performdate" column="performdate"/>
        <result property="createdate" column="createdate"/>
        <result property="preparestatus" column="preparestatus"/>
        <result property="priority" column="priority"/>
        <result property="priorityexplain" column="priorityexplain"/>
        <result property="worknature" column="worknature"/>
        <result property="isdel" column="isdel"/>
        <result property="fverid" column="fverid"/>
        <result property="isreqtake" column="isreqtake"/>
        <result property="mwaste" column="mwaste"/>
        <result property="wwaste" column="wwaste"/>
        <result property="concession" column="concession"/>
        <result property="lwaste" column="lwaste"/>
        <result property="repairs" column="repairs"/>
        <result property="repairgoods" column="repairgoods"/>
        
    </resultMap>
	<resultMap id="RM.Icmo.Process.List" class="com.terrence.crm.dol.bean.Icmo">
        <result property="icmoid" column="icmoid"/>
        <result property="fbillno" column="fbillno"/>
        <result property="fitemid" column="fitemid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="plancommitdate" column="plancommitdate"/>
        <result property="planfinishdate" column="planfinishdate"/>
        <result property="status" column="status"/>
        <result property="fqty" column="fqty"/>
        <result property="dispathstatu" column="dispathstatu"/>
        <result property="tasktype" column="tasktype"/>
        <result property="performstatus" column="performstatus"/>
        <result property="performdate" column="performdate"/>
        <result property="createdate" column="createdate"/>
        <result property="preparestatus" column="preparestatus"/>
        <result property="priority" column="priority"/>
        <result property="priorityexplain" column="priorityexplain"/>
        <result property="worknature" column="worknature"/>
        <result property="isdel" column="isdel"/>
        <result property="sys" column="sys"/>
        <result property="fverid" column="fverid"/>
        <result property="formatno" column="formatno"/>
        <result property="inventoryfqty" column="inventoryfqty"/>        
        <result property="listdispatchwork" column="icmoid" select="Icmo.GetProcess"/>
        <result property="listinventory" column="itemcode" select="Icmo.Inventory"/>
        <result property="itemVer" resultMap="RM.Icmo.ItemVer"/>
        
        <result property="planstatus" column="planstatus"/>
        <result property="reqtakestatus" column="reqtakestatus"/>
        <result property="downfqty"  column="fbillno" select="Icmo.findDownFqty"/>
        
        <result property="overstatus" column="overstatus"/>
        <result property="overempid" column="overempid"/>
        <result property="overempname" column="overempname"/>
        <result property="overdate" column="overdate"/>
        <result property="workplanid" column="workplanid"/>
        <result property="icmono" column="icmono"/>
        
    </resultMap>
    
    <resultMap id="RM.Icmo.getbyid.getoverdate" class="com.terrence.crm.dol.bean.Icmo" >
    	<result property="overdate" column="overdate"/>
    </resultMap>
    
    
    
    <resultMap class="com.terrence.crm.dol.bean.ItemVer" id="RM.Icmo.ItemVer">
	        <result property="baseitemid" column="baseitemid"/>
	        <result property="fversion" column="fversion"/>
	        <result property="itemcode" column="itemcode"/>
	        <result property="isdefault" column="isdefault"/>
	        <result property="finishstatus" column="finishstatus"/>
	        <result property="wfstatus" column="wfstatus"/>
	        <result property="imgpath" column="imgpath"/>
	        <result property="adminid" column="adminid"/>
	        <result property="auditor" column="auditor"/>
    </resultMap>
    <resultMap class="com.terrence.crm.dol.bean.DispatchWork" id="Dispatch.Process">
    	<result property="itemprocessid" column="itemprocessid"/>
        <result property="status" column="status"/>
        <result property="processname" column="processname"/>
        <result property="acceptednum" column="acceptednum"/>
        
        
    </resultMap>
    <resultMap class="com.terrence.crm.dol.bean.Inventory" id="RM.Icmo.Inventory">
    	<result property="itemcode" column="itemcode"/>
    	<result property="itemname" column="itemname"/>
    	<result property="fqty" column="fqty"/>
    	<result property="useqty" column="parentqty"/>
    	<result property="parentunitname" column="parentunitname"/>
    </resultMap>
    
	<resultMap class="com.terrence.crm.dol.bean.Icmo" id="RM.Icmo.Process" groupBy="itemcode">
		<result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="listItemPorcess" resultMap="RM.ItemProcess.Icmo"/>
	</resultMap>  
	<resultMap id="RM.ItemProcess.Icmo" class="com.terrence.crm.dol.bean.ItemProcess">
        <result property="processid" column="processid"/>
        <result property="processname" column="processname"/>
        <result property="orderid" column="orderid"/>
    </resultMap>  
    <resultMap class="com.terrence.crm.dol.bean.Icmo" id="RM.Icmo.making">
    	<result property="fqty" column="fqty"/>
    </resultMap>
    
    <resultMap  id="RM.Icmo.BaseDate" class="com.terrence.crm.dol.bean.Icmo">
    	<result property="icmoid" column="icmoid"/>
    	<result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
    	<result property="formatno" column="formatno"/>
    	<result property="inventoryfqty" column="inventoryfqty"/>
    	<result property="plancommitdate" column="plancommitdate"/>
    	<result property="planfinishdate" column="planfinishdate"/>
    	<result property="fqty" column="fqty"/>
    	
    </resultMap>
    
    <resultMap id="RM.Icmo.fxmark" class="com.terrence.crm.dol.bean.Icmo">
        <result property="icmoid" column="icmoid"/>
        <result property="fbillno" column="fbillno"/>
        <result property="fitemid" column="fitemid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="plancommitdate" column="plancommitdate"/>
        <result property="planfinishdate" column="planfinishdate"/>
        <result property="status" column="status"/>
        <result property="fqty" column="fqty"/>
        <result property="dispathstatu" column="dispathstatu"/>
        <result property="tasktype" column="tasktype"/>
        <result property="performstatus" column="performstatus"/>
        <result property="performdate" column="performdate"/>
        <result property="createdate" column="createdate"/>
        <result property="preparestatus" column="preparestatus"/>
        <result property="priority" column="priority"/>
        <result property="priorityexplain" column="priorityexplain"/>
        <result property="worknature" column="worknature"/>
        <result property="isdel" column="isdel"/>
        <result property="fverid" column="fverid"/>
        <result property="isreqtake" column="isreqtake"/>
        
        <result property="fxmark" column="fxmark"/>
        <result property="mwaste" column="mwaste"/>
        <result property="wwaste" column="wwaste"/>
        <result property="concession" column="concession"/>
        <result property="lwaste" column="lwaste"/>
    </resultMap>
    
    
    <resultMap id="RM.Icmo.Monthly.data.list" class="com.terrence.crm.dol.bean.Icmo">
        <result property="icmoid" column="icmoid"/>
        <result property="fbillno" column="fbillno"/>
        <result property="fitemid" column="fitemid"/>
        <result property="itemcode" column="itemcode"/>
        <result property="itemname" column="itemname"/>
        <result property="plancommitdate" column="plancommitdate"/>
        <result property="planfinishdate" column="planfinishdate"/>
        <result property="status" column="status"/>
        <result property="fqty" column="fqty"/>
        <result property="dispathstatu" column="dispathstatu"/>
        <result property="tasktype" column="tasktype"/>
        <result property="performstatus" column="performstatus"/>
        <result property="performdate" column="performdate"/>
        <result property="createdate" column="createdate"/>
        <result property="preparestatus" column="preparestatus"/>
        <result property="priority" column="priority"/>
        <result property="priorityexplain" column="priorityexplain"/>
        <result property="worknature" column="worknature"/>
        <result property="isdel" column="isdel"/>
        <result property="fverid" column="fverid"/>
        <result property="isreqtake" column="isreqtake"/>
       <result property="formatno" column="formatno"/>
        <result property="days" column="days"/>
        <result property="checkmaxtime" column="checkmaxtime"/>
        <result property="hours" column="hours"/>
        <result property="putstoraList" column="fbillno" select="icmo.in.putstorage.data.select"/>
        <result property="employeetaskList" column="icmoid" select="icmo.the.employeetask.startdate.data"/>
        <result property="dispatchList" column="icmoid" select="icmo.select.shijishu.data.dispatchwork"/>
        
        <result property="checkrecordList" column="icmoid" select="select.acceptnum.receivernum.data"/>
        <result property="disWorkList" column="icmoid" select="select.acceptednum.dispatchWork"/>
        <result property="crecordList" column="icmoid" select="select.sumworkdiscard.sumitemdiscard.checkrecord.data"/>
        
        <result property="checkTimeList" column="icmoid" select="checkrecode.check.time.select.data"/>
        
    </resultMap>
    
    <resultMap id="CheckRecord.hege.rbjs.data" class="com.terrence.crm.dol.bean.CheckRecord">
       <result property="sumacceptnum" column="sumacceptnum"/>
       <result property="sumreceivernum" column="sumreceivernum"/>
    </resultMap>
     <resultMap id="CheckRecord.gongfei.liaofei.data" class="com.terrence.crm.dol.bean.CheckRecord">
       <result property="sumworkdiscard" column="sumworkdiscard"/>
       <result property="sumitemdiscard" column="sumitemdiscard"/>
    </resultMap>
    <resultMap id="DispatchWork.acceptenum.sum.data" class="com.terrence.crm.dol.bean.DispatchWork">
        <result property="sumacceptednum" column="sumacceptednum"/>
    </resultMap>
    
    <resultMap id="icmo.the.putstorage.putstorageentity" class="com.terrence.crm.dol.bean.Putstorageentity">
      
        <result property="createdate" column="createdate"/>
        <result property="fqty" column="fqty"/>
        <result property="putstorage" resultMap="putstorage.data.in.icmo"/>
        <result property="inputtime" column="inputtime"/>
    </resultMap>
    <resultMap id="putstorage.data.in.icmo" class="com.terrence.crm.dol.bean.Putstorage">
      
        <result property="fbillno" column="fbillno"/>
        <result property="checkdate" column="checkdate"/>
    </resultMap>
    
    <resultMap id="RM.EmployeeTask.in.icmo.startdate" class="com.terrence.crm.dol.bean.EmployeeTask">
       <result property="startdate" column="startdate"/> 
    </resultMap>
    <resultMap id="RM.DispatchWork.in.icmo.select.acc.data" class="com.terrence.crm.dol.bean.DispatchWork">
      
        <result property="acceptednum" column="acceptednum"/>
      
    </resultMap>
    
    <resultMap id="RM.Icmo.getGroupByid" class="com.terrence.crm.dol.bean.Icmo">
    	<result property="fbillno" column="fbillno"/>
    	<result property="fbillgroup" column="fbillgroup"/>
    </resultMap>
    
    <resultMap id="checkrecode.check.time" class="com.terrence.crm.dol.bean.CheckRecord">
       <result property="checktime" column="checktime"/>
       <result property="createtime" column="createtime"/>
       <result property="checksumtime" column="checksumtime"/>
    </resultMap>
    
    
    
    <resultMap id="RM.Icmo.geticmono" class="com.terrence.crm.dol.bean.Icmo">
       <result property="fbillno" column="fbillno"/>
       <result property="icmono" column="icmono"/>
       <result property="isold" column="isold"/>
       
    </resultMap>
    
    
    
    <resultMap id="RM.Icmo.findIsBreakicmo" class="com.terrence.crm.dol.bean.Icmo">
       <result property="fbillno" column="fbillno"/>
       <result property="icmono" column="icmono"/>
       <result property="overstatus" column="overstatus"/>
       
    </resultMap>
    
    <resultMap id="Icmo.MR.select.for.the.machineMatch.data" class="com.terrence.crm.dol.bean.Icmo">
    	<result property="fbillno" column="fbillno"/>
    	 <result property="itemcode" column="itemcode"/>
        <result property="fqty" column="fqty"/>
        <result property="fxmark" column="fxmark"/>
    </resultMap>
    
	<!-- 用于select查询公用抽取的列 -->
	<sql id="Icmo.columns">
	    <![CDATA[
        	t_icmo.icmoid ,
        	t_icmo.fbillno ,
        	t_icmo.fitemid ,
        	t_icmo.itemcode ,
        	t_icmo.itemname ,
        	t_icmo.plancommitdate ,
        	t_icmo.planfinishdate ,
        	t_icmo.status ,
        	t_icmo.fqty ,
        	t_icmo.dispathstatu ,
        	t_icmo.tasktype,
        	t_icmo.performstatus ,
        	t_icmo.performdate ,
        	t_icmo.createdate ,
        	t_icmo.preparestatus ,
        	t_icmo.priority ,
        	t_icmo.priorityexplain ,
        	t_icmo.worknature ,
        	t_icmo.isdel ,
        	t_icmo.sys ,
        	t_icmo.fverid ,
        	t_icmo.isreqtake,
        	t_icmo.mwaste,
	        t_icmo.wwaste,
	        t_icmo.concession,
	        t_icmo.lwaste,
	        t_icmo.repairs,
	        t_icmo.repairgoods
	    ]]>
	</sql>
	
   <insert id="Icmo.insert" >
    
        INSERT INTO
        t_icmo (
        	fbillno ,
        	fitemid ,
        	itemcode ,
        	itemname ,
        	planfinishdate ,
        	status ,
        	fqty ,
        	dispathstatu ,
        	tasktype,
        	performstatus ,
        	priority,
        	createdate ,
        	preparestatus ,
        	worknature ,
        	isdel
        	<dynamic prepend="">
        		<isNotEmpty prepend="," property="fverid"> fverid</isNotEmpty>
        		<isNotEmpty prepend="," property="isreqtake"> isreqtake</isNotEmpty>
        		<isNotEmpty prepend="," property="fxmark"> fxmark</isNotEmpty>
        		<isNotEmpty prepend="," property="ispover">ispover</isNotEmpty>
				<isNotEmpty prepend="," property="plancommitdate">plancommitdate</isNotEmpty>
				<isNotEmpty prepend="," property="fbillgroup">fbillgroup</isNotEmpty>
        	</dynamic>	
        	
        ) VALUES (
        	#fbillno# ,
        	#fitemid# ,
        	#itemcode# ,
        	#itemname# ,
        	#planfinishdate# ,
        	#status# ,
        	#fqty# ,
        	#dispathstatu# ,
        	#tasktype# ,
        	#performstatus# ,
        	#priority#,
        	#createdate# ,
        	#preparestatus# ,
        	#worknature# ,
        	#isdel#
        	<dynamic prepend="">
        		<isNotEmpty prepend="," property="fverid"> #fverid#</isNotEmpty>
        		<isNotEmpty prepend="," property="isreqtake"> #isreqtake#</isNotEmpty>
        		<isNotEmpty prepend="," property="fxmark"> #fxmark#</isNotEmpty>
        		<isNotEmpty prepend="," property="ispover">#ispover#</isNotEmpty>
        		<isNotEmpty prepend="," property="plancommitdate">#plancommitdate#</isNotEmpty>
        		<isNotEmpty prepend="," property="fbillgroup">#fbillgroup#</isNotEmpty>
        	</dynamic>	
        )
    
    <!--
    mysql:		type="post" SELECT  select last_insert_id()
    sqlserver:	type="post" SELECT  @@identity  AS  ID
    oracle:		type="pre" 	SELECT  sequenceName.nextval AS ID FROM DUAL
    DB2:		type="pre"	values nextval for sequenceName
    -->
        <selectKey resultClass="java.lang.Long" type="post" keyProperty="icmoid" >
            SELECT  @@identity  AS  ID
        </selectKey>
    </insert>

	<update id="Icmo.update" parameterClass="com.terrence.crm.dol.bean.Icmo">         
        UPDATE t_icmo 
        <dynamic prepend="SET">
	        <isNotEmpty prepend="," property="fbillno">
	        	fbillno = #fbillno# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fitemid">
	        	fitemid = #fitemid# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemcode">
	        	itemcode = #itemcode# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="itemname">
	        	itemname = #itemname# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="plancommitdate">
	        	plancommitdate = #plancommitdate# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="planfinishdate">
	        	planfinishdate = #planfinishdate# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="status">
	        	status = #status# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fqty">
	        	fqty = #fqty# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="dispathstatu">
	        	dispathstatu = #dispathstatu# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="tasktype">
	        	tasktype = #tasktype# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="performstatus">
	        	performstatus = #performstatus# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="performdate">
	        	performdate = #performdate# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="createdate">
	        	createdate = #createdate# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="preparestatus">
	        	preparestatus = #preparestatus# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="priority">
	        	priority = #priority# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="priorityexplain">
	        	priorityexplain = #priorityexplain# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="worknature">
	        	worknature = #worknature# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="isdel">
	        	isdel = #isdel# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="sys">
	        	sys = #sys# 
	        </isNotEmpty>
	        <isNotEmpty prepend="," property="fverid">
	        	fverid = #fverid#
	        </isNotEmpty>
       		<isNotEmpty prepend="," property="isreqtake">
       		 isreqtake=#isreqtake#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="fxmark">
       		 fxmark=#fxmark#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="overstatus">
       		 overstatus=#overstatus#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="overempid">
       		 overempid=#overempid#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="overdate">
       		 overdate=#overdate#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="mwaste">
       		 mwaste=#mwaste#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="wwaste">
       		 wwaste=#wwaste#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="concession">
       		 concession=#concession#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="lwaste">
       		 lwaste=#lwaste#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="repairs">
       		 repairs=#repairs#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="repairgoods">
       		 repairgoods=#repairgoods#
       		 </isNotEmpty>
       		 <isNotEmpty prepend="," property="icmono">
       		 	icmono=#icmono#
       		 </isNotEmpty>
       		 
	    </dynamic>
        WHERE 
	        icmoid = #icmoid# 
    </update>
    
    
    <update id="Icmo.updateIcmono" parameterClass="com.terrence.crm.dol.bean.Icmo">
  	  UPDATE t_icmo set 
   			 <isNotEmpty  property="icmono">
       		 	icmono=#icmono#
       		 </isNotEmpty>
       		 <isEmpty  property="icmono">
       		 	icmono=NULL
       		 </isEmpty>
       		 <isNotEmpty prepend="," property="isold">
       		 	isold=#isold#
       		 </isNotEmpty>
	    WHERE 
	        icmoid = #icmoid# 
    </update>
    
	<delete id="Icmo.delete" parameterClass="java.lang.Long">
    <![CDATA[
        delete from t_icmo where
       icmoid = #icmoid# 
    ]]>
    </delete>
    
    <delete id="Icmo.deleteMultiple">
    <![CDATA[
        DELETE FROM 
        	t_icmo 
        WHERE
       icmoid in ($icmoid$) 
    ]]>
    </delete>
    
    <select id="Icmo.getById" resultMap="RM.Icmo">
	    select <include refid="Icmo.columns"/>
	    
	        from t_icmo 
	        where 
		        icmoid = #icmoid# 
	    
    </select>
    
    <select id="Icmo.getById.fxmark" resultMap="RM.Icmo.fxmark">
	    select <include refid="Icmo.columns"/>,t_icmo.fxmark
	      from t_icmo 
	        where 
		      icmoid = #icmoid# 
	    
    </select>
    
	<select id="Icmo.getByProperty" resultMap="RM.Icmo">
		select <include refid="Icmo.columns"/> from t_icmo where $propertyName$=#propertyValue#
	</select>
	
    <select id="Icmo.getByIcmoId" resultMap="RM.Icmo.BaseDate">
	    select  t_icmo.icmoid,t_icmo.itemcode,t_icmo.itemname,t_base_item.formatno,t_icmo.plancommitdate,t_icmo.planfinishdate,
	    isnull(t_inventory.fqty,0)+isnull(t_inventory.fqty2,0) inventoryfqty,t_icmo.fqty
	    from t_icmo left join t_base_item on t_icmo.itemcode=t_base_item.itemcode
		    left join t_inventory on t_icmo.itemcode=t_inventory.itemcode
	        where 
		        icmoid = #icmoid# 
    </select>
	
	<sql id="Icmo.findPage.where">
	    <dynamic prepend="WHERE">
	    	<isNotEmpty prepend="AND" property="overstatus">
	             t_icmo.overstatus = #overstatus#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="icmoid">
	             t_icmo.icmoid = #icmoid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fbillno">
	             t_icmo.fbillno = #fbillno#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fitemid">
	             t_icmo.fitemid = #fitemid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemcode">
	             t_icmo.itemcode  like ('%$itemcode$%') 
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemname">
	             t_icmo.itemname  like ('%$itemname$%') 
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="plancommitdateBegin">
	             t_icmo.plancommitdate &gt;= #plancommitdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="plancommitdateEnd">
	             t_icmo.plancommitdate &lt;= #plancommitdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="planfinishdateBegin">
	             t_icmo.planfinishdate &gt;= #planfinishdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="planfinishdateEnd">
	             t_icmo.planfinishdate &lt;= #planfinishdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="status">
	             t_icmo.status = #status#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fqty">
	             t_icmo.fqty = #fqty#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="dispathstatu">
	             t_icmo.dispathstatu = #dispathstatu#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="tasktype">
	             t_icmo.tasktype = #tasktype#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="performstatus">
	             t_icmo.performstatus = #performstatus#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="performstatuses">
	             t_icmo.performstatus in ($performstatuses$)
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="nonperformstatus">
	             t_icmo.performstatus != #nonperformstatus#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="performdateBegin">
	             t_icmo.performdate &gt;= #performdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="performdateEnd">
	             t_icmo.performdate &lt;= #performdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="createdateBegin">
	             t_icmo.createdate &gt;= #createdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="createdateEnd">
	             t_icmo.createdate &lt;= #createdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="preparestatus">
	             t_icmo.preparestatus = #preparestatus#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="priority">
	             t_icmo.priority = #priority#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="priorityexplain">
	             t_icmo.priorityexplain = #priorityexplain#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="worknature">
	             t_icmo.worknature = #worknature#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="isdel">
	             t_icmo.isdel = #isdel#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="sys">
	             t_icmo.sys = #sys#
	       </isNotEmpty>
	      <isNotEmpty prepend="AND" property="fbillemp">
	             t_icmo.fbillemp = #fbillemp#
	       </isNotEmpty> 
	    </dynamic>	
	</sql>
	 
    <sql id="Icmo.findPage.and">
    		<isNotEmpty prepend="AND" property="overstatus">
	             t_icmo.overstatus = #overstatus#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="icmoid">
	             t_icmo.icmoid = #icmoid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fbillno">
	             t_icmo.fbillno = #fbillno#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fitemid">
	             t_icmo.fitemid = #fitemid#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemcode">
	             t_icmo.itemcode  like ('%$itemcode$%') 
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="itemname">
	             t_icmo.itemname  like ('%$itemname$%') 
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="plancommitdateBegin">
	             t_icmo.plancommitdate &gt;= #plancommitdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="plancommitdateEnd">
	             t_icmo.plancommitdate &lt;= #plancommitdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="planfinishdateBegin">
	             t_icmo.planfinishdate &gt;= #planfinishdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="planfinishdateEnd">
	             t_icmo.planfinishdate &lt;= #planfinishdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="status">
	             t_icmo.status = #status#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="fqty">
	             t_icmo.fqty = #fqty#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="dispathstatu">
	             t_icmo.dispathstatu = #dispathstatu#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="tasktype">
	             t_icmo.tasktype = #tasktype#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="performstatus">
	             t_icmo.performstatus = #performstatus#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="performstatuses">
	             t_icmo.performstatus in ($performstatuses$)
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="nonperformstatus">
	             t_icmo.performstatus != #nonperformstatus#
	       </isNotEmpty>
			<isNotEmpty prepend="AND" property="performdateBegin">
	             t_icmo.performdate &gt;= #performdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="performdateEnd">
	             t_icmo.performdate &lt;= #performdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="createdateBegin">
	             t_icmo.createdate &gt;= #createdateBegin#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="createdateEnd">
	             t_icmo.createdate &lt;= #createdateEnd#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="preparestatus">
	             t_icmo.preparestatus = #preparestatus#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="priority">
	             t_icmo.priority = #priority#
	       </isNotEmpty>
	       
			<isNotEmpty prepend="AND" property="priorityexplain">
	             t_icmo.priorityexplain = #priorityexplain#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="worknature">
	             t_icmo.worknature = #worknature#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="isdel">
	             t_icmo.isdel = #isdel#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="sys">
	             t_icmo.sys = #sys#
	       </isNotEmpty>
	       <isNotEmpty prepend="AND" property="fbillemp">
	             t_icmo.fbillemp = #fbillemp#
	       </isNotEmpty>
	</sql>
	<select id="Icmo.making" resultMap="RM.Icmo.making">
		select sum(fqty) fqty from t_icmo where performstatus in(0,1,2) and isdel=0 and itemcode=#itemcode#
	</select>
	<!-- 审核工艺通过，查询任务单，创建班组任务 -->
	<select id="Icmo.ItemProcess" resultMap="RM.Icmo">
		select <include refid="Icmo.columns"/> from t_icmo where icmoid not in(select distinct workid from t_dispatch_work) and isdel=0 and itemcode=#itemcode#
	</select>
    <select id="Icmo.GetProcess" resultMap="Dispatch.Process">
	select t_dispatch_work.acceptednum,t_dispatch_work.status,t_dispatch_work.itemprocessid,t_dispatch_work.processname from t_dispatch_work 
	where  t_dispatch_work.workid=#icmoid#	ORDER BY t_dispatch_work.id		
	</select>
	<!--<select id="Icmo.Inventory" resultMap="RM.Icmo.Inventory">
		select t_inventory.itemcode,t_inventory.itemname,sum(isnull(t_inventory.fqty,0))+sum(isnull(t_inventory.fqty2,0)) fqty,parentqty,parentunitname 
			from t_order_bom,t_inventory 
			where t_order_bom.parentcode=t_inventory.itemcode 
			and t_order_bom.itemcode=#itemcode#
			group by t_inventory.itemcode,t_inventory.itemname,parentunitname,parentqty
	</select>
    -->
    <select id="Icmo.Inventory" resultMap="RM.Icmo.Inventory">
		select t_inventory_batch.itemcode,t_inventory_batch.itemname,sum(isnull(t_inventory_batch.fqty,0))+sum(isnull(t_inventory_batch.fqty2,0)) fqty,parentqty,parentunitname 
			from t_order_bom,t_inventory_batch 
			where t_order_bom.parentcode=t_inventory_batch.itemcode 
			and t_order_bom.itemcode=#itemcode#
			group by t_inventory_batch.itemcode,t_inventory_batch.itemname,parentunitname,parentqty
	</select>
    
    
    
    <select id="Icmo.findList" resultMap="RM.Icmo">
    	SELECT 
    		<include refid="Icmo.columns"/> 
    	FROM 
    		t_icmo
		<include refid="Icmo.findPage.where"/>
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    <select id="Icmo.findPage.Auto.count" resultClass="long">
    <![CDATA[
        select 
        count(*)
        from t_icmo
    ]]>
		<include refid="Icmo.findPage.where"/>    
    </select>
    <select id="Icmo.findPage.Auto" resultMap="RM.Icmo">
    	SELECT <include refid="Icmo.columns"/>	FROM t_icmo where 1=1 
		<isNotEmpty property="notTop">
	   	   and icmoid not in(select $notTop$ icmoid from t_icmo <include refid="Icmo.findPage.where"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="Icmo.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
    </select>
    <select id="Icmo.findPage.count" resultClass="long">
    <![CDATA[
        select 
        count(*)
        from t_icmo
    ]]>
		<include refid="Icmo.findPage.where"/>    
    </select>
    <!--
    	分页查询已经使用Dialect进行分页,也可以不使用Dialect直接编写分页
    	因为分页查询将传 #offset#,#pageSize#,#lastRows# 三个参数,不同的数据库可以根于此三个参数属性应用不同的分页实现
    -->
    <!-- select matchstatus from t_work_plan where fbillno='JiJia3132'配料状态 
		select status from t_reqtake where fbillno='JiJia3132'领料状态
		已审入库数量
		select  sum(t_putstorageentity.fqty) from  t_putstorageentity,t_putstorage  where poorderno='JiJia3132' 
		and t_putstorageentity.finterid=t_putstorage.finterid
		and t_putstorage.status=1
	-->
    <select id="Icmo.findPage" resultMap="RM.Icmo.Process.List">
    	select 
    		t_icmo.overstatus , 
			t_icmo.overempid ,
			t_admin.adminname overempname,
			t_icmo.overdate , 
			 
    		t_icmo.icmoid ,
        	t_icmo.fbillno ,
        	t_icmo.fitemid ,
        	t_icmo.itemcode ,
        	t_icmo.itemname ,
        	t_icmo.plancommitdate ,
        	t_icmo.planfinishdate ,
        	t_base_item.wfstatus as status ,
        	t_icmo.fqty ,
        	t_icmo.dispathstatu ,
        	t_icmo.tasktype,
        	t_icmo.performstatus ,
        	t_icmo.performdate ,
        	t_icmo.createdate ,
        	t_icmo.preparestatus,
	    	t_icmo.priority ,
        	t_icmo.priorityexplain ,
        	t_icmo.worknature ,
        	t_icmo.isdel,
        	t_icmo.fverid,
        	isnull(invent.fqty,0)+isnull(invent.fqty2,0) inventoryfqty,
        	t_icmo.sys,
        	t_base_item.formatno formatno,

        	t_item_ver.baseitemid ,
        	t_item_ver.fversion ,
        	t_item_ver.itemcode ,
        	t_item_ver.isdefault ,
        	t_item_ver.finishstatus,
        	t_item_ver.wfstatus ,
        	t_item_ver.imgpath ,
        	t_item_ver.adminid ,
        	t_item_ver.auditor,
        	
        	t_work_plan.matchstatus planstatus,
        	t_work_plan.workplanid,
        	t_reqtake.status reqtakestatus,
        	t_icmo.icmono
        	
	        from t_icmo  
	        left join t_base_item on t_icmo.itemcode=t_base_item.itemcode 
	        left join (select sum(fqty) fqty,sum(fqty2) fqty2,itemcode from t_inventory_batch group by itemcode) invent on t_icmo.itemcode=invent.itemcode
	        left join t_item_ver on t_icmo.fverid=t_item_ver.fverid
	        
	        left join t_work_plan on t_work_plan.fbillno=t_icmo.fbillno
	        left join t_reqtake on t_reqtake.fbillno=t_icmo.fbillno
			left join t_admin on t_icmo.overempid=t_admin.adminid
			where 1=1 
	   <isNotEmpty property="notTop">
	   	   and t_icmo.icmoid not in(select $notTop$ icmoid from t_icmo <include refid="Icmo.findPage.where"/>
	   	   <isNotEmpty property="sortColumns"> ORDER BY $sortColumns$	</isNotEmpty>) 
	   	</isNotEmpty>    
	   	<include refid="Icmo.findPage.and"/>
    	<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
		
    </select>

	<select id="Icmo.Process.findList" resultMap="RM.Icmo.Process">
	select t_item_process.itemcode,t_item_process.itemname,t_item_process.processid,t_item_process.processname,t_item_process.orderid 
	from t_icmo,t_item_process where t_icmo.status=1 and t_icmo.icmoid=t_item_process.icmoid
	<include refid="Icmo.findPage.and"/>
    	order by t_icmo.itemcode,orderid
	</select>
	
	<select id="Icmo.BaseItem.findList" resultMap="RM.Icmo">
	select <include refid="Icmo.columns"/> from t_icmo,t_base_item where wfstatus=1 and t_icmo.itemcode=t_base_item.itemcode and dispathstatu=0 
		<isNotEmpty property="sortColumns">
			ORDER BY $sortColumns$
		</isNotEmpty>
	</select>
	
	<select id="Icmo.BaseItem.findAllCounts" resultClass="java.util.HashMap">
			select top 1*from  t_icmo order by icmoid desc
	</select>
	<insert id="Icmo.insert.work">
	insert into t_icmo(fbillno,fitemid,itemcode,itemname,plancommitdate,planfinishdate,status,fqty,dispathstatu,tasktype,
	performstatus,createdate,preparestatus,sys,priority)
	select icmo.fbillno,icmo.fitemid,baseitem.itemcode,baseitem.itemname,icmo.fplancommitdate,icmo.fplanfinishdate,0,icmo.fqty,0,1,
	1,getdate(),0,1,4 from K33.AIS20160519102246.dbo.icmo icmo,K33.AIS20160519102246.dbo.t_icitem item,t_base_item baseitem
 	where icmo.fitemid=item.fitemid and item.fnumber=baseitem.itemcode and baseitem.itemcode not like '080%'
	and icmo.fstatus!=3  and not exists(select fbillno from t_icmo where icmo.fbillno=t_icmo.fbillno and sys=1)
	</insert>
	<insert id="Icmo.insert.work.004">
	insert into t_icmo(fbillno,fitemid,itemcode,itemname,plancommitdate,planfinishdate,status,fqty,dispathstatu,tasktype,
	performstatus,createdate,preparestatus,sys,priority)
	select icmo.fbillno,icmo.fitemid,baseitem.itemcode,baseitem.itemname,icmo.fplancommitdate,icmo.fplanfinishdate,0,icmo.fqty,0,1,
	1,getdate(),0,2,4 from K33.AIS20160519102246.dbo.icmo icmo,K33.AIS20160519102246.dbo.t_icitem item,t_base_item baseitem
	 where icmo.fitemid=item.fitemid and item.fnumber=baseitem.itemcode and baseitem.itemcode not like '080%'
	and icmo.fstatus!=3  and not exists(select fbillno from t_icmo where icmo.fbillno=t_icmo.fbillno and sys=2)
	</insert>
	<select id="Icmo.NotExists.findList" resultMap="RM.Icmo">
	select <include refid="Icmo.columns"/> from t_icmo,t_base_item where t_icmo.itemcode=t_base_item.itemcode and t_base_item.wfstatus=3 
	and not exists(select workid from t_dispatch_work where t_icmo.icmoid=t_dispatch_work.workid)
	</select>
	<select id="Icmo.findDownFqty" resultClass="java.lang.Double">
	select  sum(t_putstorageentity.fqty) fqty 
	from 
	 	t_putstorageentity,t_putstorage  
	 where poorderno=#fbillno# 
		and t_putstorageentity.finterid=t_putstorage.finterid
		and t_putstorage.status=1
	</select>
	
	<select id="Icmo.getbyid.getoverdate" resultMap="RM.Icmo.getbyid.getoverdate">
		select overdate from t_icmo where icmoid=#icmoid# 
	</select>
	
	    <select id="Icmo.find.data.Monthly" resultMap="RM.Icmo.Monthly.data.list">
    	SELECT 
    		<include refid="Icmo.columns"/>,t_base_item.formatno formatno,
    		datediff(dd,t_icmo.planfinishdate,t_icmo.performdate) days,
    		(select max(checktime) from t_check_record where workid = icmoid ) as checkmaxtime,
    		datediff(hh,t_icmo.performdate,(select max(checktime) from t_check_record where workid = icmoid )) hours
    	FROM 
    		t_icmo,t_base_item
		where SUBSTRING(CONVERT(varchar(20),t_icmo.planfinishdate,120),1,7)=#monthly# and t_icmo.itemcode = t_base_item.itemcode
		
    </select>
    
    <select id="icmo.in.putstorage.data.select" resultMap="icmo.the.putstorage.putstorageentity"><!-- 入库的 --> 
    	SELECT 
    		 t_putstorageentity.fqty,t_putstorageentity.createdate,t_putstorage.fbillno,t_putstorage.checkdate,
    		 datediff(hh,t_putstorageentity.createdate,t_putstorage.checkdate) inputtime
    	FROM 
    		t_putstorageentity,t_putstorage
    		where t_putstorageentity.finterid = t_putstorage.finterid and t_putstorageentity.poorderno=#fbillno#
		
    </select>
	
	
	<select id="icmo.the.employeetask.startdate.data" resultMap="RM.EmployeeTask.in.icmo.startdate"><!-- 实际开工时间 取第一序点开工的时间为实际开工时间 -->
    	SELECT 
    		top 1 t_employee_task.startdate
    	FROM 
    		t_employee_task 
		where dispatchid = ( select  min(id) from t_dispatch_work where workid = #icmoid#) order by t_employee_task.startdate
		
    </select>
    
    <select id="icmo.select.shijishu.data.dispatchwork" resultMap="RM.DispatchWork.in.icmo.select.acc.data"><!-- 实作数量如第一序为下料，取第一序的合格数量，否则取库房的发料数量 -->
    	select case (select processname from  t_dispatch_work where id in (select min(id) from t_dispatch_work where workid = #icmoid#)) when '下料' 

		then (select acceptednum  from t_dispatch_work where t_dispatch_work.id =(select min(id) from t_dispatch_work where workid = #icmoid#)) 

		else  (select top 1 fqty from t_picking_detail where t_picking_detail.ficmobillno = ( select fbillno from t_icmo where icmoid = #icmoid# ))

		end acceptednum

  		from t_dispatch_work where id in (select min(id) from t_dispatch_work where workid = #icmoid#)

    	
    </select>
    

    <select id="select.acceptnum.receivernum.data" resultMap="CheckRecord.hege.rbjs.data"><!-- 一次合格数,让步接收数-->
    	select sum(acceptnum) sumacceptnum,sum(receivernum) sumreceivernum  from t_check_record where checktype=3 and employeetaskid in (
			select employeetaskid from t_employee_task where workid =#icmoid# and dispatchid in (
				select   id  from t_dispatch_work 
				where id in (select max(id) from t_dispatch_work where  workid=#icmoid# group by workid) 
			)
		)
    </select>
     <select id="select.acceptednum.dispatchWork" resultMap="DispatchWork.acceptenum.sum.data"><!-- 合格数-->
    	select   sum(acceptednum) sumacceptednum from t_dispatch_work 
			where id in (select max(id) from t_dispatch_work where  workid =#icmoid#
			) group by workid
    </select>
	 <select id="select.sumworkdiscard.sumitemdiscard.checkrecord.data" resultMap="CheckRecord.gongfei.liaofei.data"><!-- 工废、料废-->
    	select sum(workdiscard) sumworkdiscard,sum(itemdiscard) sumitemdiscard from t_check_record where workid = #icmoid#
    </select>
    <select id="checkrecode.check.time.select.data" resultMap="checkrecode.check.time"><!-- 检验记录-->
    	select  createtime,checktime,datediff(hh,createtime,checktime) checksumtime from t_check_record where workid = #icmoid# and checktype=3
    </select>

    <select id="Icmo.getGroupByid" resultMap="RM.Icmo.getGroupByid">
    

    select fbillno ,fbillgroup from t_icmo where icmoid=#icmoid# 
    
    
    </select>
    
    
    <update id="Icmo.updtae.updateispover" parameterClass="com.terrence.crm.dol.bean.Icmo">         
        UPDATE t_icmo set ispover=#ispover# where t_icmo.fbillno=#fbillno#
    </update>    
    


    <select id="Icmo.geticmono" resultMap="RM.Icmo.geticmono">
	    select 
	    	t_icmo.fbillno ,
	    	t_icmo.icmono ,
	    	t_icmo.isold 
	   	from t_icmo where fbillno=#fbillno# 
    
    
    </select>



    <select id="Icmo.findIsBreakicmo" resultMap="RM.Icmo.findIsBreakicmo">
	    select 
	    	t_icmo.fbillno ,
	    	t_icmo.icmono ,
	    	t_icmo.overstatus 
	    	
	   	from t_icmo where fbillno!=#fbillno# and icmono=#icmono# 
    
    
    </select>


	<select id="Icmo.find.entity.data.makefqty" resultMap="Icmo.MR.select.for.the.machineMatch.data">
		 select  t_machine_match.makefqty fqty,t_machine_match.itemcode itemcode,t_icmo.fbillno,t_icmo.fxmark
	        from t_machine_match 
	        left join t_work_plan on  t_machine_match.workplanid=t_work_plan.workplanid
	        left join t_icmo on t_work_plan.fbillno=t_icmo.fbillno  
	        where 1=1 and t_icmo.icmoid = #icmoid#  and (t_icmo.isdel is null or t_icmo.isdel=0) 
	</select>
    
    
	
</sqlMap>
